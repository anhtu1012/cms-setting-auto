{"version":3,"sources":["../../../src/modules/settings/settings.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\r\nimport { InjectModel } from '@nestjs/mongoose';\r\nimport { Model } from 'mongoose';\r\nimport { Setting, SettingDocument } from './schemas/setting.schema';\r\nimport { CreateSettingDto, UpdateSettingDto } from './dto/setting.dto';\r\nimport {\r\n  PaginationDto,\r\n  PaginationResponse,\r\n} from '../../common/dto/pagination.dto';\r\n\r\n@Injectable()\r\nexport class SettingsService {\r\n  constructor(\r\n    @InjectModel(Setting.name) private settingModel: Model<SettingDocument>,\r\n  ) {}\r\n\r\n  async create(createSettingDto: CreateSettingDto): Promise<Setting> {\r\n    const createdSetting = new this.settingModel(createSettingDto);\r\n    return createdSetting.save();\r\n  }\r\n\r\n  async findAll(\r\n    paginationDto: PaginationDto,\r\n  ): Promise<PaginationResponse<Setting>> {\r\n    const { page = 1, limit = 10, search } = paginationDto;\r\n    const skip = (page - 1) * limit;\r\n\r\n    const query = search\r\n      ? {\r\n          $or: [\r\n            { key: { $regex: search, $options: 'i' } },\r\n            { description: { $regex: search, $options: 'i' } },\r\n          ],\r\n        }\r\n      : {};\r\n\r\n    const [data, total] = await Promise.all([\r\n      this.settingModel.find(query).skip(skip).limit(limit).exec(),\r\n      this.settingModel.countDocuments(query).exec(),\r\n    ]);\r\n\r\n    return {\r\n      data,\r\n      total,\r\n      page,\r\n      limit,\r\n      totalPages: Math.ceil(total / limit),\r\n    };\r\n  }\r\n\r\n  async findOne(id: string): Promise<Setting | null> {\r\n    return this.settingModel.findById(id).exec();\r\n  }\r\n\r\n  async findByKey(key: string): Promise<Setting | null> {\r\n    return this.settingModel.findOne({ key }).exec();\r\n  }\r\n\r\n  async findByCategory(category: string): Promise<Setting[]> {\r\n    return this.settingModel.find({ category }).exec();\r\n  }\r\n\r\n  async update(\r\n    id: string,\r\n    updateSettingDto: UpdateSettingDto,\r\n  ): Promise<Setting | null> {\r\n    return this.settingModel\r\n      .findByIdAndUpdate(id, updateSettingDto, { new: true })\r\n      .exec();\r\n  }\r\n\r\n  async updateByKey(key: string, value: any): Promise<Setting | null> {\r\n    return this.settingModel\r\n      .findOneAndUpdate({ key }, { value }, { new: true })\r\n      .exec();\r\n  }\r\n\r\n  async remove(id: string): Promise<Setting | null> {\r\n    return this.settingModel.findByIdAndDelete(id).exec();\r\n  }\r\n}\r\n"],"names":["SettingsService","create","createSettingDto","createdSetting","settingModel","save","findAll","paginationDto","page","limit","search","skip","query","$or","key","$regex","$options","description","data","total","Promise","all","find","exec","countDocuments","totalPages","Math","ceil","findOne","id","findById","findByKey","findByCategory","category","update","updateSettingDto","findByIdAndUpdate","new","updateByKey","value","findOneAndUpdate","remove","findByIdAndDelete","name"],"mappings":";;;;+BAWaA;;;eAAAA;;;wBAXc;0BACC;2BACN;+BACmB;;;;;;;;;;;;;;;AAQlC,IAAA,AAAMA,kBAAN,MAAMA;IAKX,MAAMC,OAAOC,gBAAkC,EAAoB;QACjE,MAAMC,iBAAiB,IAAI,IAAI,CAACC,YAAY,CAACF;QAC7C,OAAOC,eAAeE,IAAI;IAC5B;IAEA,MAAMC,QACJC,aAA4B,EACU;QACtC,MAAM,EAAEC,OAAO,CAAC,EAAEC,QAAQ,EAAE,EAAEC,MAAM,EAAE,GAAGH;QACzC,MAAMI,OAAO,AAACH,CAAAA,OAAO,CAAA,IAAKC;QAE1B,MAAMG,QAAQF,SACV;YACEG,KAAK;gBACH;oBAAEC,KAAK;wBAAEC,QAAQL;wBAAQM,UAAU;oBAAI;gBAAE;gBACzC;oBAAEC,aAAa;wBAAEF,QAAQL;wBAAQM,UAAU;oBAAI;gBAAE;aAClD;QACH,IACA,CAAC;QAEL,MAAM,CAACE,MAAMC,MAAM,GAAG,MAAMC,QAAQC,GAAG,CAAC;YACtC,IAAI,CAACjB,YAAY,CAACkB,IAAI,CAACV,OAAOD,IAAI,CAACA,MAAMF,KAAK,CAACA,OAAOc,IAAI;YAC1D,IAAI,CAACnB,YAAY,CAACoB,cAAc,CAACZ,OAAOW,IAAI;SAC7C;QAED,OAAO;YACLL;YACAC;YACAX;YACAC;YACAgB,YAAYC,KAAKC,IAAI,CAACR,QAAQV;QAChC;IACF;IAEA,MAAMmB,QAAQC,EAAU,EAA2B;QACjD,OAAO,IAAI,CAACzB,YAAY,CAAC0B,QAAQ,CAACD,IAAIN,IAAI;IAC5C;IAEA,MAAMQ,UAAUjB,GAAW,EAA2B;QACpD,OAAO,IAAI,CAACV,YAAY,CAACwB,OAAO,CAAC;YAAEd;QAAI,GAAGS,IAAI;IAChD;IAEA,MAAMS,eAAeC,QAAgB,EAAsB;QACzD,OAAO,IAAI,CAAC7B,YAAY,CAACkB,IAAI,CAAC;YAAEW;QAAS,GAAGV,IAAI;IAClD;IAEA,MAAMW,OACJL,EAAU,EACVM,gBAAkC,EACT;QACzB,OAAO,IAAI,CAAC/B,YAAY,CACrBgC,iBAAiB,CAACP,IAAIM,kBAAkB;YAAEE,KAAK;QAAK,GACpDd,IAAI;IACT;IAEA,MAAMe,YAAYxB,GAAW,EAAEyB,KAAU,EAA2B;QAClE,OAAO,IAAI,CAACnC,YAAY,CACrBoC,gBAAgB,CAAC;YAAE1B;QAAI,GAAG;YAAEyB;QAAM,GAAG;YAAEF,KAAK;QAAK,GACjDd,IAAI;IACT;IAEA,MAAMkB,OAAOZ,EAAU,EAA2B;QAChD,OAAO,IAAI,CAACzB,YAAY,CAACsC,iBAAiB,CAACb,IAAIN,IAAI;IACrD;IAnEA,YACE,AAAmCnB,YAAoC,CACvE;aADmCA,eAAAA;IAClC;AAkEL;;;mEAnEyBuC"}