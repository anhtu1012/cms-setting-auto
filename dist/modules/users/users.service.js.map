{"version":3,"sources":["../../../src/modules/users/users.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\r\nimport { InjectModel } from '@nestjs/mongoose';\r\nimport { Model } from 'mongoose';\r\nimport { User, UserDocument } from './schemas/user.schema';\r\nimport { CreateUserDto, UpdateUserDto } from './dto/user.dto';\r\nimport {\r\n  PaginationDto,\r\n  PaginationResponse,\r\n} from '../../common/dto/pagination.dto';\r\n\r\n@Injectable()\r\nexport class UsersService {\r\n  constructor(@InjectModel(User.name) private userModel: Model<UserDocument>) {}\r\n\r\n  async create(createUserDto: CreateUserDto): Promise<User> {\r\n    const createdUser = new this.userModel(createUserDto);\r\n    return createdUser.save();\r\n  }\r\n\r\n  async findAll(\r\n    paginationDto: PaginationDto,\r\n  ): Promise<PaginationResponse<User>> {\r\n    const { page = 1, limit = 10, search } = paginationDto;\r\n    const skip = (page - 1) * limit;\r\n\r\n    const query = search\r\n      ? {\r\n          $or: [\r\n            { email: { $regex: search, $options: 'i' } },\r\n            { firstName: { $regex: search, $options: 'i' } },\r\n            { lastName: { $regex: search, $options: 'i' } },\r\n          ],\r\n        }\r\n      : {};\r\n\r\n    const [data, total] = await Promise.all([\r\n      this.userModel.find(query).skip(skip).limit(limit).exec(),\r\n      this.userModel.countDocuments(query).exec(),\r\n    ]);\r\n\r\n    return {\r\n      data,\r\n      total,\r\n      page,\r\n      limit,\r\n      totalPages: Math.ceil(total / limit),\r\n    };\r\n  }\r\n\r\n  async findOne(id: string): Promise<User | null> {\r\n    return this.userModel.findById(id).exec();\r\n  }\r\n\r\n  async findByEmail(email: string): Promise<User | null> {\r\n    return this.userModel.findOne({ email }).exec();\r\n  }\r\n\r\n  async update(id: string, updateUserDto: UpdateUserDto): Promise<User | null> {\r\n    return this.userModel\r\n      .findByIdAndUpdate(id, updateUserDto, { new: true })\r\n      .exec();\r\n  }\r\n\r\n  async remove(id: string): Promise<User | null> {\r\n    return this.userModel.findByIdAndDelete(id).exec();\r\n  }\r\n}\r\n"],"names":["UsersService","create","createUserDto","createdUser","userModel","save","findAll","paginationDto","page","limit","search","skip","query","$or","email","$regex","$options","firstName","lastName","data","total","Promise","all","find","exec","countDocuments","totalPages","Math","ceil","findOne","id","findById","findByEmail","update","updateUserDto","findByIdAndUpdate","new","remove","findByIdAndDelete","name"],"mappings":";;;;+BAWaA;;;eAAAA;;;wBAXc;0BACC;2BACN;4BACa;;;;;;;;;;;;;;;AAQ5B,IAAA,AAAMA,eAAN,MAAMA;IAGX,MAAMC,OAAOC,aAA4B,EAAiB;QACxD,MAAMC,cAAc,IAAI,IAAI,CAACC,SAAS,CAACF;QACvC,OAAOC,YAAYE,IAAI;IACzB;IAEA,MAAMC,QACJC,aAA4B,EACO;QACnC,MAAM,EAAEC,OAAO,CAAC,EAAEC,QAAQ,EAAE,EAAEC,MAAM,EAAE,GAAGH;QACzC,MAAMI,OAAO,AAACH,CAAAA,OAAO,CAAA,IAAKC;QAE1B,MAAMG,QAAQF,SACV;YACEG,KAAK;gBACH;oBAAEC,OAAO;wBAAEC,QAAQL;wBAAQM,UAAU;oBAAI;gBAAE;gBAC3C;oBAAEC,WAAW;wBAAEF,QAAQL;wBAAQM,UAAU;oBAAI;gBAAE;gBAC/C;oBAAEE,UAAU;wBAAEH,QAAQL;wBAAQM,UAAU;oBAAI;gBAAE;aAC/C;QACH,IACA,CAAC;QAEL,MAAM,CAACG,MAAMC,MAAM,GAAG,MAAMC,QAAQC,GAAG,CAAC;YACtC,IAAI,CAAClB,SAAS,CAACmB,IAAI,CAACX,OAAOD,IAAI,CAACA,MAAMF,KAAK,CAACA,OAAOe,IAAI;YACvD,IAAI,CAACpB,SAAS,CAACqB,cAAc,CAACb,OAAOY,IAAI;SAC1C;QAED,OAAO;YACLL;YACAC;YACAZ;YACAC;YACAiB,YAAYC,KAAKC,IAAI,CAACR,QAAQX;QAChC;IACF;IAEA,MAAMoB,QAAQC,EAAU,EAAwB;QAC9C,OAAO,IAAI,CAAC1B,SAAS,CAAC2B,QAAQ,CAACD,IAAIN,IAAI;IACzC;IAEA,MAAMQ,YAAYlB,KAAa,EAAwB;QACrD,OAAO,IAAI,CAACV,SAAS,CAACyB,OAAO,CAAC;YAAEf;QAAM,GAAGU,IAAI;IAC/C;IAEA,MAAMS,OAAOH,EAAU,EAAEI,aAA4B,EAAwB;QAC3E,OAAO,IAAI,CAAC9B,SAAS,CAClB+B,iBAAiB,CAACL,IAAII,eAAe;YAAEE,KAAK;QAAK,GACjDZ,IAAI;IACT;IAEA,MAAMa,OAAOP,EAAU,EAAwB;QAC7C,OAAO,IAAI,CAAC1B,SAAS,CAACkC,iBAAiB,CAACR,IAAIN,IAAI;IAClD;IArDA,YAAY,AAAgCpB,SAA8B,CAAE;aAAhCA,YAAAA;IAAiC;AAsD/E;;;6DAtDgCmC"}