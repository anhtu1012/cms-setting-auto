{"version":3,"sources":["../../../../src/modules/users/schemas/user.schema.ts"],"sourcesContent":["import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';\r\nimport { Document } from 'mongoose';\r\n\r\nexport type UserDocument = User & Document;\r\n\r\n@Schema({ timestamps: true })\r\nexport class User {\r\n  @Prop({ required: true, unique: true })\r\n  email: string;\r\n\r\n  @Prop({ required: true, unique: true })\r\n  userName: string;\r\n\r\n  @Prop({ required: true })\r\n  password: string;\r\n\r\n  @Prop({ required: true })\r\n  firstName: string;\r\n\r\n  @Prop({ required: true })\r\n  lastName: string;\r\n\r\n  @Prop({ default: 'user', enum: ['admin', 'user', 'editor'] })\r\n  role: string;\r\n\r\n  @Prop({ default: true })\r\n  isActive: boolean;\r\n\r\n  @Prop()\r\n  avatar?: string;\r\n\r\n  @Prop()\r\n  lastLogin?: Date;\r\n\r\n  // Account Tier Information - Sử dụng tierCode động thay vì enum\r\n  @Prop({\r\n    type: String,\r\n    default: 'free', // Default tier code\r\n    index: true,\r\n  })\r\n  tier: string; // tierCode: 'free', 'basic', 'premium', 'enterprise', hoặc tùy chỉnh\r\n\r\n  @Prop()\r\n  tierStartDate?: Date;\r\n\r\n  @Prop()\r\n  tierExpiryDate?: Date;\r\n\r\n  @Prop({\r\n    type: [\r\n      {\r\n        tier: String,\r\n        startDate: Date,\r\n        endDate: Date,\r\n        upgradeReason: String,\r\n      },\r\n    ],\r\n    default: [],\r\n  })\r\n  tierHistory: Array<{\r\n    tier: string; // tierCode\r\n    startDate: Date;\r\n    endDate?: Date;\r\n    upgradeReason?: string;\r\n  }>;\r\n\r\n  // Usage Statistics (để tracking giới hạn)\r\n  @Prop({ default: 0 })\r\n  currentDatabaseCount: number;\r\n\r\n  @Prop()\r\n  lastApiCallReset?: Date;\r\n\r\n  @Prop({ default: 0 })\r\n  apiCallsToday: number;\r\n\r\n  // Wallet and Points Information\r\n  @Prop({ default: 0 })\r\n  points: number;\r\n\r\n  @Prop({ default: 0 })\r\n  walletBalance: number;\r\n\r\n  @Prop({\r\n    type: [{ date: Date, amount: Number, type: String, description: String }],\r\n    default: [],\r\n  })\r\n  walletTransactions: Array<{\r\n    date: Date;\r\n    amount: number;\r\n    type: string; // 'credit' or 'debit'\r\n    description: string;\r\n  }>;\r\n\r\n  @Prop({ type: [{ date: Date, points: Number, reason: String }], default: [] })\r\n  pointsHistory: Array<{\r\n    date: Date;\r\n    points: number;\r\n    reason: string;\r\n  }>;\r\n}\r\n\r\nexport const UserSchema = SchemaFactory.createForClass(User);\r\n"],"names":["User","UserSchema","required","unique","default","enum","type","String","index","tier","startDate","Date","endDate","upgradeReason","date","amount","Number","description","points","reason","timestamps","SchemaFactory","createForClass"],"mappings":";;;;;;;;;;;QAMaA;eAAAA;;QAgGAC;eAAAA;;;0BAtG+B;;;;;;;;;;AAMrC,IAAA,AAAMD,OAAN,MAAMA;AA8Fb;;;QA7FUE,UAAU;QAAMC,QAAQ;;;;;;QAGxBD,UAAU;QAAMC,QAAQ;;;;;;QAGxBD,UAAU;;;;;;QAGVA,UAAU;;;;;;QAGVA,UAAU;;;;;;QAGVE,SAAS;QAAQC,MAAM;YAAC;YAAS;YAAQ;SAAS;;;;;;QAGlDD,SAAS;;;;;;;;;;;;;;QAWfE,MAAMC;QACNH,SAAS;QACTI,OAAO;;;;;;;;;;;;;;QAWPF,MAAM;YACJ;gBACEG,MAAMF;gBACNG,WAAWC;gBACXC,SAASD;gBACTE,eAAeN;YACjB;SACD;QACDH,SAAS,EAAE;;;;;;QAULA,SAAS;;;;;;;;;;QAMTA,SAAS;;;;;;QAITA,SAAS;;;;;;QAGTA,SAAS;;;;;;QAIfE,MAAM;YAAC;gBAAEQ,MAAMH;gBAAMI,QAAQC;gBAAQV,MAAMC;gBAAQU,aAAaV;YAAO;SAAE;QACzEH,SAAS,EAAE;;;;;;QASLE,MAAM;YAAC;gBAAEQ,MAAMH;gBAAMO,QAAQF;gBAAQG,QAAQZ;YAAO;SAAE;QAAEH,SAAS,EAAE;;;;;;QAzFnEgB,YAAY;;;AAiGf,MAAMnB,aAAaoB,uBAAa,CAACC,cAAc,CAACtB"}