{"version":3,"sources":["../../../../src/modules/dynamic-cms/schemas/collection-schema.schema.ts"],"sourcesContent":["import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';\r\nimport { Document, Types } from 'mongoose';\r\nimport { FieldDefinition } from '../interfaces/field-types.interface';\r\n\r\nexport type CollectionSchemaDocument = CollectionSchemaModel & Document;\r\n\r\n/**\r\n * Schema lưu trữ cấu trúc của các collection động\r\n * Đây là \"meta-schema\" - schema định nghĩa các schema khác\r\n * Mỗi collection thuộc về 1 database và 1 user\r\n */\r\n@Schema({ timestamps: true, collection: 'collection_schemas' })\r\nexport class CollectionSchemaModel {\r\n  @Prop({ type: Types.ObjectId, ref: 'Database', required: true, index: true })\r\n  databaseId: Types.ObjectId; // Database chứa collection này\r\n\r\n  @Prop({ type: Types.ObjectId, ref: 'User', required: true, index: true })\r\n  userId: Types.ObjectId; // User sở hữu collection này\r\n\r\n  @Prop({ required: true, index: true })\r\n  name: string; // Tên collection (slug): \"products\", \"posts\"\r\n\r\n  @Prop({ required: true })\r\n  displayName: string; // Tên hiển thị: \"Sản phẩm\", \"Bài viết\"\r\n\r\n  @Prop()\r\n  description?: string;\r\n\r\n  @Prop()\r\n  icon?: string;\r\n\r\n  @Prop({ type: Array, required: true })\r\n  fields: FieldDefinition[]; // Danh sách các field\r\n\r\n  @Prop({ default: true })\r\n  timestamps: boolean;\r\n\r\n  @Prop({ default: false })\r\n  softDelete: boolean;\r\n\r\n  @Prop({ default: true })\r\n  enableApi: boolean;\r\n\r\n  @Prop()\r\n  apiPath?: string;\r\n\r\n  @Prop({ type: Object })\r\n  permissions?: {\r\n    create?: string[];\r\n    read?: string[];\r\n    update?: string[];\r\n    delete?: string[];\r\n  };\r\n\r\n  @Prop()\r\n  createdBy?: string;\r\n\r\n  @Prop()\r\n  updatedBy?: string;\r\n\r\n  @Prop({ default: 1 })\r\n  version: number;\r\n\r\n  @Prop({ default: 0 })\r\n  dataCount?: number; // Số lượng records trong collection này\r\n}\r\n\r\nexport const CollectionSchemaSchema = SchemaFactory.createForClass(\r\n  CollectionSchemaModel,\r\n);\r\n\r\n// Index cho search và performance\r\nCollectionSchemaSchema.index({ userId: 1, databaseId: 1 });\r\nCollectionSchemaSchema.index({ databaseId: 1, name: 1 }, { unique: true }); // Trong 1 DB không có 2 collection cùng tên\r\nCollectionSchemaSchema.index({ userId: 1, name: 1 });\r\nCollectionSchemaSchema.index({ createdBy: 1 });\r\n"],"names":["CollectionSchemaModel","CollectionSchemaSchema","type","Types","ObjectId","ref","required","index","Array","default","Object","timestamps","collection","SchemaFactory","createForClass","userId","databaseId","name","unique","createdBy"],"mappings":";;;;;;;;;;;QAYaA;eAAAA;;QAuDAC;eAAAA;;;0BAnE+B;2BACZ;;;;;;;;;;AAWzB,IAAA,AAAMD,wBAAN,MAAMA;AAqDb;;;QApDUE,MAAMC,gBAAK,CAACC,QAAQ;QAAEC,KAAK;QAAYC,UAAU;QAAMC,OAAO;;mGACpD,qDAAA;;;;QAEVL,MAAMC,gBAAK,CAACC,QAAQ;QAAEC,KAAK;QAAQC,UAAU;QAAMC,OAAO;;mGACpD,qDAAA;;;;QAEND,UAAU;QAAMC,OAAO;;;;;;QAGvBD,UAAU;;;;;;;;;;;;;;QASVJ,MAAMM;QAAOF,UAAU;;;;;;QAGvBG,SAAS;;;;;;QAGTA,SAAS;;;;;;QAGTA,SAAS;;;;;;;;;;QAMTP,MAAMQ;;;;;;;;;;;;;;QAcND,SAAS;;;;;;QAGTA,SAAS;;;;;;QApDTE,YAAY;QAAMC,YAAY;;;AAwDjC,MAAMX,yBAAyBY,uBAAa,CAACC,cAAc,CAChEd;AAGF,kCAAkC;AAClCC,uBAAuBM,KAAK,CAAC;IAAEQ,QAAQ;IAAGC,YAAY;AAAE;AACxDf,uBAAuBM,KAAK,CAAC;IAAES,YAAY;IAAGC,MAAM;AAAE,GAAG;IAAEC,QAAQ;AAAK,IAAI,4CAA4C;AACxHjB,uBAAuBM,KAAK,CAAC;IAAEQ,QAAQ;IAAGE,MAAM;AAAE;AAClDhB,uBAAuBM,KAAK,CAAC;IAAEY,WAAW;AAAE"}