{"version":3,"sources":["../../../../src/modules/dynamic-cms/schemas/dynamic-data.schema.ts"],"sourcesContent":["import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';\r\nimport { Document, Types } from 'mongoose';\r\n\r\nexport type DynamicDataDocument = DynamicData & Document;\r\n\r\n/**\r\n * Schema lưu trữ dữ liệu động của user\r\n * Mọi data của các collection động sẽ được lưu vào đây\r\n * Mỗi record thuộc về 1 user, 1 database và 1 collection\r\n */\r\n@Schema({ timestamps: true, collection: 'dynamic_data' })\r\nexport class DynamicData {\r\n  @Prop({ type: Types.ObjectId, ref: 'User', required: false, index: true })\r\n  userId?: Types.ObjectId; // User sở hữu data này (optional cho public API)\r\n\r\n  @Prop({ type: Types.ObjectId, ref: 'Database', required: true, index: true })\r\n  databaseId: Types.ObjectId; // Database chứa data này\r\n\r\n  @Prop({ required: true, index: true })\r\n  _collection: string; // Tên collection này thuộc về\r\n\r\n  @Prop({ type: Object, required: true })\r\n  _data: Record<string, any>; // Dữ liệu thực tế (flexible schema)\r\n\r\n  @Prop({ type: Date, default: null })\r\n  deletedAt?: Date | null; // Cho soft delete\r\n\r\n  @Prop({ type: String })\r\n  createdBy?: string;\r\n\r\n  @Prop({ type: String })\r\n  updatedBy?: string;\r\n}\r\n\r\nexport const DynamicDataSchema = SchemaFactory.createForClass(DynamicData);\r\n\r\n// Indexes để query nhanh\r\nDynamicDataSchema.index({ userId: 1, databaseId: 1, _collection: 1 });\r\nDynamicDataSchema.index({ userId: 1, _collection: 1, deletedAt: 1 });\r\nDynamicDataSchema.index({ databaseId: 1, _collection: 1, deletedAt: 1 });\r\nDynamicDataSchema.index({ _collection: 1, createdAt: -1 });\r\nDynamicDataSchema.index({ createdBy: 1 });\r\nDynamicDataSchema.index({ userId: 1, createdAt: -1 });\r\n\r\n// Virtual để access data dễ hơn\r\nDynamicDataSchema.virtual('data').get(function () {\r\n  return this._data;\r\n});\r\n"],"names":["DynamicData","DynamicDataSchema","type","Types","ObjectId","ref","required","index","Object","Date","default","String","timestamps","collection","SchemaFactory","createForClass","userId","databaseId","_collection","deletedAt","createdAt","createdBy","virtual","get","_data"],"mappings":";;;;;;;;;;;QAWaA;eAAAA;;QAuBAC;eAAAA;;;0BAlC+B;2BACZ;;;;;;;;;;AAUzB,IAAA,AAAMD,cAAN,MAAMA;AAqBb;;;QApBUE,MAAMC,gBAAK,CAACC,QAAQ;QAAEC,KAAK;QAAQC,UAAU;QAAOC,OAAO;;mGACpD,qDAAA;;;;QAEPL,MAAMC,gBAAK,CAACC,QAAQ;QAAEC,KAAK;QAAYC,UAAU;QAAMC,OAAO;;mGACpD,qDAAA;;;;QAEVD,UAAU;QAAMC,OAAO;;;;;;QAGvBL,MAAMM;QAAQF,UAAU;;;;;;QAGxBJ,MAAMO;QAAMC,SAAS;;;;;;QAGrBR,MAAMS;;;;;;QAGNT,MAAMS;;;;;;QApBNC,YAAY;QAAMC,YAAY;;;AAwBjC,MAAMZ,oBAAoBa,uBAAa,CAACC,cAAc,CAACf;AAE9D,yBAAyB;AACzBC,kBAAkBM,KAAK,CAAC;IAAES,QAAQ;IAAGC,YAAY;IAAGC,aAAa;AAAE;AACnEjB,kBAAkBM,KAAK,CAAC;IAAES,QAAQ;IAAGE,aAAa;IAAGC,WAAW;AAAE;AAClElB,kBAAkBM,KAAK,CAAC;IAAEU,YAAY;IAAGC,aAAa;IAAGC,WAAW;AAAE;AACtElB,kBAAkBM,KAAK,CAAC;IAAEW,aAAa;IAAGE,WAAW,CAAC;AAAE;AACxDnB,kBAAkBM,KAAK,CAAC;IAAEc,WAAW;AAAE;AACvCpB,kBAAkBM,KAAK,CAAC;IAAES,QAAQ;IAAGI,WAAW,CAAC;AAAE;AAEnD,gCAAgC;AAChCnB,kBAAkBqB,OAAO,CAAC,QAAQC,GAAG,CAAC;IACpC,OAAO,IAAI,CAACC,KAAK;AACnB"}