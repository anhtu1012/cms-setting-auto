{"version":3,"sources":["../../../../../src/modules/dynamic-cms/controller/dynamic-data/dynamic-data.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Body,\r\n  Patch,\r\n  Put,\r\n  Param,\r\n  Delete,\r\n  Query,\r\n  Request,\r\n} from '@nestjs/common';\r\nimport {\r\n  ApiTags,\r\n  ApiOperation,\r\n  ApiResponse,\r\n  ApiQuery,\r\n  ApiParam,\r\n  ApiBody,\r\n} from '@nestjs/swagger';\r\nimport { PaginationDto } from '../../../../common/dto/pagination.dto';\r\nimport { DynamicDataService } from './dynamic-data.service';\r\n\r\n@ApiTags('dynamic-data')\r\n@Controller(':databaseId/:collectionName')\r\nexport class DynamicDataController {\r\n  constructor(private readonly dynamicDataService: DynamicDataService) {}\r\n\r\n  @Post()\r\n  @ApiOperation({ summary: 'Create new document in dynamic collection' })\r\n  @ApiParam({ name: 'databaseId', example: '507f1f77bcf86cd799439011' })\r\n  @ApiParam({ name: 'collectionName', example: 'products' })\r\n  @ApiBody({\r\n    description: 'Document data to create',\r\n    schema: {\r\n      type: 'object',\r\n      example: {\r\n        product_name: 'iPhone 15 Pro',\r\n        sku: 'IPHONE-15-PRO',\r\n        price: 999.99,\r\n        category: 'electronics',\r\n        description: 'Latest iPhone model',\r\n        tags: ['new', 'bestseller'],\r\n        in_stock: true,\r\n      },\r\n    },\r\n  })\r\n  @ApiResponse({ status: 201, description: 'Document created successfully' })\r\n  @ApiResponse({ status: 400, description: 'Validation failed' })\r\n  @ApiResponse({ status: 404, description: 'Collection schema not found' })\r\n  create(\r\n    @Param('databaseId') databaseId: string,\r\n    @Param('collectionName') collectionName: string,\r\n    @Body() data: Record<string, any>,\r\n    @Request() req,\r\n  ) {\r\n    const userId = req?.user?.userId || null;\r\n    return this.dynamicDataService.create(\r\n      collectionName,\r\n      databaseId,\r\n      data,\r\n      userId,\r\n    );\r\n  }\r\n\r\n  @Get()\r\n  @ApiOperation({ summary: 'Get all documents from dynamic collection' })\r\n  @ApiParam({ name: 'databaseId', example: '507f1f77bcf86cd799439011' })\r\n  @ApiParam({ name: 'collectionName', example: 'products' })\r\n  @ApiQuery({ name: 'page', required: false, type: Number, example: 1 })\r\n  @ApiQuery({ name: 'limit', required: false, type: Number, example: 10 })\r\n  @ApiQuery({ name: 'search', required: false, type: String })\r\n  @ApiResponse({ status: 200, description: 'Documents retrieved' })\r\n  findAll(\r\n    @Param('databaseId') databaseId: string,\r\n    @Param('collectionName') collectionName: string,\r\n    @Query() paginationDto: PaginationDto,\r\n    @Request() req,\r\n  ) {\r\n    const userId = req?.user?.userId || null;\r\n    return this.dynamicDataService.findAll(\r\n      collectionName,\r\n      userId,\r\n      databaseId,\r\n      paginationDto,\r\n    );\r\n  }\r\n\r\n  @Post('query')\r\n  @ApiOperation({ summary: 'Query documents with custom filter' })\r\n  @ApiParam({ name: 'databaseId', example: '507f1f77bcf86cd799439011' })\r\n  @ApiParam({ name: 'collectionName', example: 'products' })\r\n  @ApiBody({\r\n    description: 'Query filter with optional sort, limit, skip',\r\n    schema: {\r\n      type: 'object',\r\n      properties: {\r\n        filter: {\r\n          type: 'object',\r\n          example: { category: 'electronics', in_stock: true },\r\n        },\r\n        sort: {\r\n          type: 'object',\r\n          example: { price: -1, createdAt: -1 },\r\n        },\r\n        limit: { type: 'number', example: 20 },\r\n        skip: { type: 'number', example: 0 },\r\n      },\r\n    },\r\n  })\r\n  @ApiResponse({ status: 200, description: 'Query results returned' })\r\n  query(\r\n    @Param('databaseId') databaseId: string,\r\n    @Param('collectionName') collectionName: string,\r\n    @Body()\r\n    body: {\r\n      filter: Record<string, any>;\r\n      sort?: Record<string, 1 | -1>;\r\n      limit?: number;\r\n      skip?: number;\r\n    },\r\n  ) {\r\n    return this.dynamicDataService.query(collectionName, body.filter, {\r\n      sort: body.sort,\r\n      limit: body.limit,\r\n      skip: body.skip,\r\n    });\r\n  }\r\n\r\n  @Get('count')\r\n  @ApiOperation({ summary: 'Count documents in collection' })\r\n  @ApiParam({ name: 'databaseId', example: '507f1f77bcf86cd799439011' })\r\n  @ApiParam({ name: 'collectionName', example: 'products' })\r\n  @ApiResponse({ status: 200, description: 'Count returned' })\r\n  count(\r\n    @Param('databaseId') databaseId: string,\r\n    @Param('collectionName') collectionName: string,\r\n  ) {\r\n    return this.dynamicDataService.count(collectionName);\r\n  }\r\n\r\n  @Get(':id')\r\n  @ApiOperation({ summary: 'Get document by ID' })\r\n  @ApiParam({ name: 'databaseId', example: '507f1f77bcf86cd799439011' })\r\n  @ApiParam({ name: 'collectionName', example: 'products' })\r\n  @ApiParam({ name: 'id', example: '507f1f77bcf86cd799439011' })\r\n  @ApiResponse({ status: 200, description: 'Document found' })\r\n  @ApiResponse({ status: 404, description: 'Document not found' })\r\n  findOne(\r\n    @Param('databaseId') databaseId: string,\r\n    @Param('collectionName') collectionName: string,\r\n    @Param('id') id: string,\r\n    @Request() req,\r\n  ) {\r\n    const userId = req?.user?.userId || null;\r\n    return this.dynamicDataService.findById(\r\n      collectionName,\r\n      id,\r\n      userId,\r\n      databaseId,\r\n    );\r\n  }\r\n\r\n  @Patch(':id')\r\n  @ApiOperation({ summary: 'Update document by ID' })\r\n  @ApiParam({ name: 'databaseId', example: '507f1f77bcf86cd799439011' })\r\n  @ApiParam({ name: 'collectionName', example: 'products' })\r\n  @ApiParam({ name: 'id', example: '507f1f77bcf86cd799439011' })\r\n  @ApiBody({\r\n    description: 'Fields to update (partial update supported)',\r\n    schema: {\r\n      type: 'object',\r\n      example: {\r\n        price: 899.99,\r\n        in_stock: false,\r\n      },\r\n    },\r\n  })\r\n  @ApiResponse({ status: 200, description: 'Document updated' })\r\n  @ApiResponse({ status: 400, description: 'Validation failed' })\r\n  @ApiResponse({ status: 404, description: 'Document not found' })\r\n  update(\r\n    @Param('databaseId') databaseId: string,\r\n    @Param('collectionName') collectionName: string,\r\n    @Param('id') id: string,\r\n    @Body() data: Record<string, any>,\r\n    @Request() req,\r\n  ) {\r\n    const userId = req?.user?.userId || null;\r\n    return this.dynamicDataService.update(\r\n      collectionName,\r\n      id,\r\n      databaseId,\r\n      data,\r\n      userId,\r\n    );\r\n  }\r\n\r\n  @Put(':id')\r\n  @ApiOperation({ summary: 'Replace document by ID (full replacement)' })\r\n  @ApiParam({ name: 'databaseId', example: '507f1f77bcf86cd799439011' })\r\n  @ApiParam({ name: 'collectionName', example: 'products' })\r\n  @ApiParam({ name: 'id', example: '507f1f77bcf86cd799439011' })\r\n  @ApiBody({\r\n    description: 'Complete document data (replaces entire document)',\r\n    schema: {\r\n      type: 'object',\r\n      example: {\r\n        product_name: 'iPhone 15 Pro Max',\r\n        sku: 'IPHONE-15-PRO-MAX',\r\n        price: 1199.99,\r\n        category: 'electronics',\r\n        description: 'Latest iPhone model with larger screen',\r\n        tags: ['new', 'bestseller', 'premium'],\r\n        in_stock: true,\r\n      },\r\n    },\r\n  })\r\n  @ApiResponse({ status: 200, description: 'Document replaced' })\r\n  @ApiResponse({ status: 400, description: 'Validation failed' })\r\n  @ApiResponse({ status: 404, description: 'Document not found' })\r\n  replace(\r\n    @Param('databaseId') databaseId: string,\r\n    @Param('collectionName') collectionName: string,\r\n    @Param('id') id: string,\r\n    @Body() data: Record<string, any>,\r\n    @Request() req,\r\n  ) {\r\n    const userId = req?.user?.userId || null;\r\n    return this.dynamicDataService.replace(\r\n      collectionName,\r\n      id,\r\n      databaseId,\r\n      data,\r\n      userId,\r\n    );\r\n  }\r\n\r\n  @Delete(':id')\r\n  @ApiOperation({ summary: 'Soft delete document by ID' })\r\n  @ApiParam({ name: 'databaseId', example: '507f1f77bcf86cd799439011' })\r\n  @ApiParam({ name: 'collectionName', example: 'products' })\r\n  @ApiParam({ name: 'id', example: '507f1f77bcf86cd799439011' })\r\n  @ApiResponse({ status: 200, description: 'Document deleted' })\r\n  @ApiResponse({ status: 404, description: 'Document not found' })\r\n  softDelete(\r\n    @Param('databaseId') databaseId: string,\r\n    @Param('collectionName') collectionName: string,\r\n    @Param('id') id: string,\r\n    @Request() req,\r\n  ) {\r\n    const userId = req?.user?.userId || null;\r\n    return this.dynamicDataService.softDelete(\r\n      collectionName,\r\n      id,\r\n      userId,\r\n      databaseId,\r\n    );\r\n  }\r\n\r\n  @Delete(':id/hard')\r\n  @ApiOperation({ summary: 'Permanently delete document by ID' })\r\n  @ApiParam({ name: 'databaseId', example: '507f1f77bcf86cd799439011' })\r\n  @ApiParam({ name: 'collectionName', example: 'products' })\r\n  @ApiParam({ name: 'id', example: '507f1f77bcf86cd799439011' })\r\n  @ApiResponse({ status: 200, description: 'Document permanently deleted' })\r\n  @ApiResponse({ status: 404, description: 'Document not found' })\r\n  hardDelete(\r\n    @Param('databaseId') databaseId: string,\r\n    @Param('collectionName') collectionName: string,\r\n    @Param('id') id: string,\r\n    @Request() req,\r\n  ) {\r\n    const userId = req?.user?.userId || null;\r\n    return this.dynamicDataService.hardDelete(\r\n      collectionName,\r\n      id,\r\n      userId,\r\n      databaseId,\r\n    );\r\n  }\r\n\r\n  @Post(':id/restore')\r\n  @ApiOperation({ summary: 'Restore soft-deleted document' })\r\n  @ApiParam({ name: 'databaseId', example: '507f1f77bcf86cd799439011' })\r\n  @ApiParam({ name: 'collectionName', example: 'products' })\r\n  @ApiParam({ name: 'id', example: '507f1f77bcf86cd799439011' })\r\n  @ApiResponse({ status: 200, description: 'Document restored' })\r\n  @ApiResponse({ status: 404, description: 'Document not found' })\r\n  restore(\r\n    @Param('databaseId') databaseId: string,\r\n    @Param('collectionName') collectionName: string,\r\n    @Param('id') id: string,\r\n    @Request() req,\r\n  ) {\r\n    const userId = req?.user?.userId || null;\r\n    return this.dynamicDataService.restore(\r\n      collectionName,\r\n      id,\r\n      userId,\r\n      databaseId,\r\n    );\r\n  }\r\n}\r\n"],"names":["DynamicDataController","create","databaseId","collectionName","data","req","userId","user","dynamicDataService","findAll","paginationDto","query","body","filter","sort","limit","skip","count","findOne","id","findById","update","replace","softDelete","hardDelete","restore","summary","name","example","description","schema","type","product_name","sku","price","category","tags","in_stock","status","required","Number","String","properties","createdAt"],"mappings":"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"}