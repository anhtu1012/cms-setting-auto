{"version":3,"sources":["../../../../../src/modules/dynamic-cms/controller/dynamic-data/dynamic-data.service.ts"],"sourcesContent":["import {\r\n  Injectable,\r\n  NotFoundException,\r\n  BadRequestException,\r\n  ForbiddenException,\r\n} from '@nestjs/common';\r\nimport { InjectModel } from '@nestjs/mongoose';\r\nimport { Model, FilterQuery, Types } from 'mongoose';\r\nimport {\r\n  DynamicData,\r\n  DynamicDataDocument,\r\n} from '../../schemas/dynamic-data.schema';\r\nimport { CollectionSchemaService } from '../collection-schema/collection-schema.service';\r\nimport {\r\n  PaginationDto,\r\n  PaginationResponse,\r\n} from '../../../../common/dto/pagination.dto';\r\nimport { RelationshipService } from './relationship.service';\r\nimport { FieldType } from '../../interfaces/field-types.interface';\r\n\r\n@Injectable()\r\nexport class DynamicDataService {\r\n  constructor(\r\n    @InjectModel(DynamicData.name)\r\n    private dynamicDataModel: Model<DynamicDataDocument>,\r\n    private collectionSchemaService: CollectionSchemaService,\r\n    private relationshipService: RelationshipService,\r\n  ) {}\r\n\r\n  /**\r\n   * Transform document để trả về data phẳng, không có lớp _data\r\n   */\r\n  private transformDocument(doc: any): any {\r\n    if (!doc) return null;\r\n\r\n    const plainDoc = doc.toObject ? doc.toObject() : doc;\r\n    const { _data, ...rest } = plainDoc;\r\n\r\n    return {\r\n      ...rest,\r\n      ..._data, // Flatten _data vào root level\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Transform array of documents\r\n   */\r\n  private transformDocuments(docs: any[]): any[] {\r\n    return docs.map((doc) => this.transformDocument(doc));\r\n  }\r\n\r\n  /**\r\n   * Tạo document mới trong collection động\r\n   */\r\n  async create(\r\n    collectionName: string,\r\n    databaseId: string,\r\n    data: Record<string, any>,\r\n    userId: string | null,\r\n    options?: { populate?: boolean; populateDepth?: number },\r\n  ): Promise<DynamicData> {\r\n    // Kiểm tra collection schema có tồn tại không (không check ownership)\r\n    const schema = await this.collectionSchemaService.findByNamePublic(\r\n      collectionName,\r\n      databaseId,\r\n    );\r\n\r\n    if (!schema) {\r\n      throw new NotFoundException(\r\n        `Collection schema \"${collectionName}\" not found`,\r\n      );\r\n    }\r\n\r\n    // Validate dữ liệu (public - không check ownership)\r\n    const validation = await this.collectionSchemaService.validateDataPublic(\r\n      collectionName,\r\n      databaseId,\r\n      data,\r\n    );\r\n    if (!validation.valid) {\r\n      throw new BadRequestException({\r\n        message: 'Validation failed',\r\n        errors: validation.errors,\r\n      });\r\n    }\r\n\r\n    // Validate references nếu có\r\n    await this.validateReferencesInData(schema, databaseId, data);\r\n\r\n    // Tạo document\r\n    const document = new this.dynamicDataModel({\r\n      _collection: collectionName,\r\n      userId: userId ? new Types.ObjectId(userId) : null,\r\n      databaseId: new Types.ObjectId(databaseId),\r\n      _data: data,\r\n      createdBy: userId,\r\n      updatedBy: userId,\r\n    });\r\n\r\n    const saved = await document.save();\r\n    let result = this.transformDocument(saved);\r\n\r\n    // Populate nếu được yêu cầu\r\n    if (options?.populate) {\r\n      result = await this.relationshipService.populateDocument(\r\n        collectionName,\r\n        databaseId,\r\n        result,\r\n        options.populateDepth || 1,\r\n      );\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Validate tất cả references trong data\r\n   */\r\n  private async validateReferencesInData(\r\n    schema: any,\r\n    databaseId: string,\r\n    data: Record<string, any>,\r\n  ): Promise<void> {\r\n    const referenceFields = schema.fields.filter(\r\n      (field) => field.type === FieldType.REFERENCE && field.referenceConfig,\r\n    );\r\n\r\n    for (const field of referenceFields) {\r\n      const refConfig = field.referenceConfig;\r\n      const fieldValue = data[field.name];\r\n\r\n      if (!fieldValue) continue;\r\n\r\n      if (refConfig.multiple && Array.isArray(fieldValue)) {\r\n        // Validate multiple references\r\n        const validation = await this.relationshipService.validateReferences(\r\n          refConfig.collection,\r\n          databaseId,\r\n          fieldValue,\r\n        );\r\n        if (!validation.valid) {\r\n          throw new BadRequestException(\r\n            `Invalid references in field \"${field.name}\": ${validation.invalidIds.join(', ')}`,\r\n          );\r\n        }\r\n      } else if (!Array.isArray(fieldValue)) {\r\n        // Validate single reference\r\n        const isValid = await this.relationshipService.validateReference(\r\n          refConfig.collection,\r\n          databaseId,\r\n          fieldValue,\r\n        );\r\n        if (!isValid) {\r\n          throw new BadRequestException(\r\n            `Invalid reference in field \"${field.name}\": ${fieldValue}`,\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Tạo nhiều documents cùng lúc (bulk create)\r\n   */\r\n  async createMany(\r\n    collectionName: string,\r\n    databaseId: string,\r\n    dataArray: Record<string, any>[],\r\n    userId: string | null,\r\n  ): Promise<{\r\n    success: number;\r\n    failed: number;\r\n    results: Array<{\r\n      success: boolean;\r\n      data?: DynamicData;\r\n      error?: string;\r\n      index: number;\r\n    }>;\r\n  }> {\r\n    // Kiểm tra collection schema có tồn tại không\r\n    const schema = await this.collectionSchemaService.findByNamePublic(\r\n      collectionName,\r\n      databaseId,\r\n    );\r\n\r\n    if (!schema) {\r\n      throw new NotFoundException(\r\n        `Collection schema \"${collectionName}\" not found`,\r\n      );\r\n    }\r\n\r\n    const results = [];\r\n    let successCount = 0;\r\n    let failedCount = 0;\r\n\r\n    // Xử lý từng document\r\n    for (let i = 0; i < dataArray.length; i++) {\r\n      try {\r\n        const data = dataArray[i];\r\n\r\n        // Validate dữ liệu\r\n        const validation =\r\n          await this.collectionSchemaService.validateDataPublic(\r\n            collectionName,\r\n            databaseId,\r\n            data,\r\n          );\r\n\r\n        if (!validation.valid) {\r\n          results.push({\r\n            success: false,\r\n            error: `Validation failed: ${JSON.stringify(validation.errors)}`,\r\n            index: i,\r\n          });\r\n          failedCount++;\r\n          continue;\r\n        }\r\n\r\n        // Tạo document\r\n        const document = new this.dynamicDataModel({\r\n          _collection: collectionName,\r\n          userId: userId ? new Types.ObjectId(userId) : null,\r\n          databaseId: new Types.ObjectId(databaseId),\r\n          _data: data,\r\n          createdBy: userId,\r\n          updatedBy: userId,\r\n        });\r\n\r\n        const saved = await document.save();\r\n        results.push({\r\n          success: true,\r\n          data: this.transformDocument(saved),\r\n          index: i,\r\n        });\r\n        successCount++;\r\n      } catch (error) {\r\n        results.push({\r\n          success: false,\r\n          error: error.message || 'Unknown error',\r\n          index: i,\r\n        });\r\n        failedCount++;\r\n      }\r\n    }\r\n\r\n    return {\r\n      success: successCount,\r\n      failed: failedCount,\r\n      results,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Thay thế toàn bộ data cũ bằng data mới (replace all)\r\n   * Xóa tất cả documents cũ và tạo mới từ mảng\r\n   */\r\n  async replaceAll(\r\n    collectionName: string,\r\n    databaseId: string,\r\n    dataArray: Record<string, any>[],\r\n    userId: string | null,\r\n  ): Promise<{\r\n    deleted: number;\r\n    created: number;\r\n    failed: number;\r\n    results: Array<{\r\n      success: boolean;\r\n      data?: DynamicData;\r\n      error?: string;\r\n      index: number;\r\n    }>;\r\n  }> {\r\n    // Kiểm tra collection schema có tồn tại không\r\n    const schema = await this.collectionSchemaService.findByNamePublic(\r\n      collectionName,\r\n      databaseId,\r\n    );\r\n\r\n    if (!schema) {\r\n      throw new NotFoundException(\r\n        `Collection schema \"${collectionName}\" not found`,\r\n      );\r\n    }\r\n\r\n    // Xóa tất cả documents cũ trong collection\r\n    const deleteQuery: FilterQuery<DynamicDataDocument> = {\r\n      _collection: collectionName,\r\n      databaseId: new Types.ObjectId(databaseId),\r\n    };\r\n\r\n    // Chỉ xóa documents của user nếu có userId\r\n    if (userId) {\r\n      deleteQuery.userId = new Types.ObjectId(userId);\r\n    }\r\n\r\n    const deleteResult = await this.dynamicDataModel.deleteMany(deleteQuery);\r\n    const deletedCount = deleteResult.deletedCount || 0;\r\n\r\n    // Tạo documents mới\r\n    const results = [];\r\n    let createdCount = 0;\r\n    let failedCount = 0;\r\n\r\n    for (let i = 0; i < dataArray.length; i++) {\r\n      try {\r\n        const data = dataArray[i];\r\n\r\n        // Validate dữ liệu\r\n        const validation =\r\n          await this.collectionSchemaService.validateDataPublic(\r\n            collectionName,\r\n            databaseId,\r\n            data,\r\n          );\r\n\r\n        if (!validation.valid) {\r\n          results.push({\r\n            success: false,\r\n            error: `Validation failed: ${JSON.stringify(validation.errors)}`,\r\n            index: i,\r\n          });\r\n          failedCount++;\r\n          continue;\r\n        }\r\n\r\n        // Tạo document mới\r\n        const document = new this.dynamicDataModel({\r\n          _collection: collectionName,\r\n          userId: userId ? new Types.ObjectId(userId) : null,\r\n          databaseId: new Types.ObjectId(databaseId),\r\n          _data: data,\r\n          createdBy: userId,\r\n          updatedBy: userId,\r\n        });\r\n\r\n        const saved = await document.save();\r\n        results.push({\r\n          success: true,\r\n          data: this.transformDocument(saved),\r\n          index: i,\r\n        });\r\n        createdCount++;\r\n      } catch (error) {\r\n        results.push({\r\n          success: false,\r\n          error: error.message || 'Unknown error',\r\n          index: i,\r\n        });\r\n        failedCount++;\r\n      }\r\n    }\r\n\r\n    return {\r\n      deleted: deletedCount,\r\n      created: createdCount,\r\n      failed: failedCount,\r\n      results,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Lấy danh sách documents trong collection của user\r\n   */\r\n  async findAll(\r\n    collectionName: string,\r\n    userId: string | null,\r\n    databaseId: string,\r\n    paginationDto: PaginationDto,\r\n    filter?: Record<string, any>,\r\n    options?: { populate?: boolean; populateDepth?: number },\r\n  ): Promise<PaginationResponse<DynamicData>> {\r\n    const { page = 1, limit = 10, search } = paginationDto;\r\n    const skip = (page - 1) * limit;\r\n\r\n    // Kiểm tra collection schema (không check ownership)\r\n    const schema = await this.collectionSchemaService.findByNamePublic(\r\n      collectionName,\r\n      databaseId,\r\n    );\r\n\r\n    if (!schema) {\r\n      throw new NotFoundException(\r\n        `Collection schema \"${collectionName}\" not found`,\r\n      );\r\n    }\r\n\r\n    // Build query\r\n    const query: FilterQuery<DynamicDataDocument> = {\r\n      _collection: collectionName,\r\n      databaseId: new Types.ObjectId(databaseId),\r\n      deletedAt: null, // Không lấy các bản ghi đã xóa\r\n    };\r\n\r\n    // Chỉ thêm userId filter nếu có\r\n    if (userId) {\r\n      query.userId = new Types.ObjectId(userId);\r\n    }\r\n\r\n    // Thêm filter nếu có\r\n    if (filter) {\r\n      Object.keys(filter).forEach((key) => {\r\n        query[`_data.${key}`] = filter[key];\r\n      });\r\n    }\r\n\r\n    // Thêm search nếu có\r\n    if (search) {\r\n      const searchableFields = schema.fields\r\n        .filter((f) => f.searchable)\r\n        .map((f) => f.name);\r\n\r\n      if (searchableFields.length > 0) {\r\n        query.$or = searchableFields.map((fieldName) => ({\r\n          [`_data.${fieldName}`]: { $regex: search, $options: 'i' },\r\n        }));\r\n      }\r\n    }\r\n\r\n    const [data, total] = await Promise.all([\r\n      this.dynamicDataModel\r\n        .find(query)\r\n        .skip(skip)\r\n        .limit(limit)\r\n        .sort({ createdAt: -1 })\r\n        .exec(),\r\n      this.dynamicDataModel.countDocuments(query).exec(),\r\n    ]);\r\n\r\n    let transformedData = this.transformDocuments(data);\r\n\r\n    // Populate nếu được yêu cầu\r\n    if (options?.populate) {\r\n      transformedData = await this.relationshipService.populateDocuments(\r\n        collectionName,\r\n        databaseId,\r\n        transformedData,\r\n        options.populateDepth || 1,\r\n      );\r\n    }\r\n\r\n    return {\r\n      data: transformedData,\r\n      total,\r\n      page,\r\n      limit,\r\n      totalPages: Math.ceil(total / limit),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Lấy document theo ID và kiểm tra ownership\r\n   */\r\n  async findById(\r\n    collectionName: string,\r\n    id: string,\r\n    userId: string | null,\r\n    databaseId: string,\r\n    options?: { populate?: boolean; populateDepth?: number },\r\n  ): Promise<DynamicData | null> {\r\n    const query: any = {\r\n      _id: id,\r\n      _collection: collectionName,\r\n      databaseId: new Types.ObjectId(databaseId),\r\n      deletedAt: null,\r\n    };\r\n\r\n    if (userId) {\r\n      query.userId = new Types.ObjectId(userId);\r\n    }\r\n\r\n    const document = await this.dynamicDataModel.findOne(query).exec();\r\n\r\n    if (!document) {\r\n      throw new NotFoundException(\r\n        `Document not found in collection \"${collectionName}\"`,\r\n      );\r\n    }\r\n\r\n    let result = this.transformDocument(document);\r\n\r\n    // Populate nếu được yêu cầu\r\n    if (options?.populate) {\r\n      result = await this.relationshipService.populateDocument(\r\n        collectionName,\r\n        databaseId,\r\n        result,\r\n        options.populateDepth || 1,\r\n      );\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Cập nhật document\r\n   */\r\n  async update(\r\n    collectionName: string,\r\n    id: string,\r\n    databaseId: string,\r\n    data: Record<string, any>,\r\n    userId: string | null,\r\n  ): Promise<DynamicData | null> {\r\n    // Kiểm tra document có tồn tại không và kiểm tra ownership\r\n    const query: any = {\r\n      _id: id,\r\n      _collection: collectionName,\r\n      databaseId: new Types.ObjectId(databaseId),\r\n      deletedAt: null,\r\n    };\r\n\r\n    if (userId) {\r\n      query.userId = new Types.ObjectId(userId);\r\n    }\r\n\r\n    const existing = await this.dynamicDataModel.findOne(query).exec();\r\n\r\n    if (!existing) {\r\n      throw new NotFoundException(\r\n        `Document not found in collection \"${collectionName}\"`,\r\n      );\r\n    }\r\n\r\n    // Merge data cũ với data mới\r\n    const mergedData = { ...existing._data, ...data };\r\n\r\n    // Validate dữ liệu mới (public)\r\n    const validation = await this.collectionSchemaService.validateDataPublic(\r\n      collectionName,\r\n      databaseId,\r\n      mergedData,\r\n    );\r\n    if (!validation.valid) {\r\n      throw new BadRequestException({\r\n        message: 'Validation failed',\r\n        errors: validation.errors,\r\n      });\r\n    }\r\n\r\n    // Cập nhật\r\n    const updated = await this.dynamicDataModel\r\n      .findByIdAndUpdate(\r\n        id,\r\n        {\r\n          _data: mergedData,\r\n          updatedBy: userId,\r\n        },\r\n        { new: true },\r\n      )\r\n      .exec();\r\n\r\n    return this.transformDocument(updated);\r\n  }\r\n\r\n  /**\r\n   * Thay thế hoàn toàn document (PUT)\r\n   */\r\n  async replace(\r\n    collectionName: string,\r\n    id: string,\r\n    databaseId: string,\r\n    data: Record<string, any>,\r\n    userId: string | null,\r\n  ): Promise<any> {\r\n    // Kiểm tra document có tồn tại không và kiểm tra ownership\r\n    const query: any = {\r\n      _id: id,\r\n      _collection: collectionName,\r\n      databaseId: new Types.ObjectId(databaseId),\r\n      deletedAt: null,\r\n    };\r\n\r\n    if (userId) {\r\n      query.userId = new Types.ObjectId(userId);\r\n    }\r\n\r\n    const existing = await this.dynamicDataModel.findOne(query).exec();\r\n\r\n    if (!existing) {\r\n      throw new NotFoundException(\r\n        `Document not found in collection \"${collectionName}\"`,\r\n      );\r\n    }\r\n\r\n    // Validate dữ liệu mới (không merge, thay thế hoàn toàn) - public\r\n    const validation = await this.collectionSchemaService.validateDataPublic(\r\n      collectionName,\r\n      databaseId,\r\n      data,\r\n    );\r\n    if (!validation.valid) {\r\n      throw new BadRequestException({\r\n        message: 'Validation failed',\r\n        errors: validation.errors,\r\n      });\r\n    }\r\n\r\n    // Thay thế hoàn toàn\r\n    const replaced = await this.dynamicDataModel\r\n      .findByIdAndUpdate(\r\n        id,\r\n        {\r\n          _data: data, // Thay thế hoàn toàn, không merge\r\n          updatedBy: userId,\r\n        },\r\n        { new: true },\r\n      )\r\n      .exec();\r\n\r\n    return this.transformDocument(replaced);\r\n  }\r\n\r\n  /**\r\n   * Xóa document (soft delete)\r\n   */\r\n  async softDelete(\r\n    collectionName: string,\r\n    id: string,\r\n    userId: string | null,\r\n    databaseId: string,\r\n  ): Promise<DynamicData | null> {\r\n    const document = await this.findById(\r\n      collectionName,\r\n      id,\r\n      userId,\r\n      databaseId,\r\n    );\r\n    if (!document) {\r\n      throw new NotFoundException(\r\n        `Document not found in collection \"${collectionName}\"`,\r\n      );\r\n    }\r\n\r\n    const deleted = await this.dynamicDataModel\r\n      .findByIdAndUpdate(id, { deletedAt: new Date() }, { new: true })\r\n      .exec();\r\n\r\n    return this.transformDocument(deleted);\r\n  }\r\n\r\n  /**\r\n   * Xóa document vĩnh viễn\r\n   */\r\n  async hardDelete(\r\n    collectionName: string,\r\n    id: string,\r\n    userId: string | null,\r\n    databaseId: string,\r\n  ): Promise<DynamicData | null> {\r\n    const query: any = {\r\n      _id: id,\r\n      _collection: collectionName,\r\n      databaseId: new Types.ObjectId(databaseId),\r\n    };\r\n\r\n    if (userId) {\r\n      query.userId = new Types.ObjectId(userId);\r\n    }\r\n\r\n    const document = await this.dynamicDataModel.findOne(query).exec();\r\n\r\n    if (!document) {\r\n      throw new NotFoundException(\r\n        `Document not found in collection \"${collectionName}\"`,\r\n      );\r\n    }\r\n\r\n    const deleted = await this.dynamicDataModel.findByIdAndDelete(id).exec();\r\n    return this.transformDocument(deleted);\r\n  }\r\n\r\n  /**\r\n   * Restore document đã xóa\r\n   */\r\n  async restore(\r\n    collectionName: string,\r\n    id: string,\r\n    userId: string | null,\r\n    databaseId: string,\r\n  ): Promise<DynamicData | null> {\r\n    const query: any = {\r\n      _id: id,\r\n      _collection: collectionName,\r\n      databaseId: new Types.ObjectId(databaseId),\r\n    };\r\n\r\n    if (userId) {\r\n      query.userId = new Types.ObjectId(userId);\r\n    }\r\n\r\n    const document = await this.dynamicDataModel.findOne(query).exec();\r\n\r\n    if (!document) {\r\n      throw new NotFoundException(\r\n        `Document not found in collection \"${collectionName}\"`,\r\n      );\r\n    }\r\n\r\n    const restored = await this.dynamicDataModel\r\n      .findByIdAndUpdate(id, { deletedAt: null }, { new: true })\r\n      .exec();\r\n\r\n    return this.transformDocument(restored);\r\n  }\r\n\r\n  /**\r\n   * Query với điều kiện phức tạp\r\n   */\r\n  async query(\r\n    collectionName: string,\r\n    queryFilter: Record<string, any>,\r\n    options?: {\r\n      sort?: Record<string, 1 | -1>;\r\n      limit?: number;\r\n      skip?: number;\r\n    },\r\n  ): Promise<DynamicData[]> {\r\n    const query: FilterQuery<DynamicDataDocument> = {\r\n      _collection: collectionName,\r\n      deletedAt: null,\r\n    };\r\n\r\n    // Transform filter to query _data fields\r\n    Object.keys(queryFilter).forEach((key) => {\r\n      query[`_data.${key}`] = queryFilter[key];\r\n    });\r\n\r\n    let queryBuilder = this.dynamicDataModel.find(query);\r\n\r\n    if (options?.sort) {\r\n      queryBuilder = queryBuilder.sort(options.sort);\r\n    }\r\n\r\n    if (options?.skip) {\r\n      queryBuilder = queryBuilder.skip(options.skip);\r\n    }\r\n\r\n    if (options?.limit) {\r\n      queryBuilder = queryBuilder.limit(options.limit);\r\n    }\r\n\r\n    const results = await queryBuilder.exec();\r\n    return this.transformDocuments(results);\r\n  }\r\n\r\n  /**\r\n   * Đếm số lượng documents\r\n   */\r\n  async count(\r\n    collectionName: string,\r\n    filter?: Record<string, any>,\r\n  ): Promise<number> {\r\n    const query: FilterQuery<DynamicDataDocument> = {\r\n      _collection: collectionName,\r\n      deletedAt: null,\r\n    };\r\n\r\n    if (filter) {\r\n      Object.keys(filter).forEach((key) => {\r\n        query[`_data.${key}`] = filter[key];\r\n      });\r\n    }\r\n\r\n    return this.dynamicDataModel.countDocuments(query).exec();\r\n  }\r\n}\r\n"],"names":["DynamicDataService","transformDocument","doc","plainDoc","toObject","_data","rest","transformDocuments","docs","map","create","collectionName","databaseId","data","userId","options","schema","collectionSchemaService","findByNamePublic","NotFoundException","validation","validateDataPublic","valid","BadRequestException","message","errors","validateReferencesInData","document","dynamicDataModel","_collection","Types","ObjectId","createdBy","updatedBy","saved","save","result","populate","relationshipService","populateDocument","populateDepth","referenceFields","fields","filter","field","type","FieldType","REFERENCE","referenceConfig","refConfig","fieldValue","name","multiple","Array","isArray","validateReferences","collection","invalidIds","join","isValid","validateReference","createMany","dataArray","results","successCount","failedCount","i","length","push","success","error","JSON","stringify","index","failed","replaceAll","deleteQuery","deleteResult","deleteMany","deletedCount","createdCount","deleted","created","findAll","paginationDto","page","limit","search","skip","query","deletedAt","Object","keys","forEach","key","searchableFields","f","searchable","$or","fieldName","$regex","$options","total","Promise","all","find","sort","createdAt","exec","countDocuments","transformedData","populateDocuments","totalPages","Math","ceil","findById","id","_id","findOne","update","existing","mergedData","updated","findByIdAndUpdate","new","replace","replaced","softDelete","Date","hardDelete","findByIdAndDelete","restore","restored","queryFilter","queryBuilder","count"],"mappings":"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"}