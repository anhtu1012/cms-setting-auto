{"version":3,"sources":["../../../../../src/modules/dynamic-cms/controller/database/database.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Put,\r\n  Delete,\r\n  Body,\r\n  Param,\r\n  Query,\r\n  UseGuards,\r\n  Request,\r\n  HttpCode,\r\n  HttpStatus,\r\n} from '@nestjs/common';\r\nimport {\r\n  ApiTags,\r\n  ApiOperation,\r\n  ApiResponse,\r\n  ApiBearerAuth,\r\n} from '@nestjs/swagger';\r\nimport { DatabaseService } from './database.service';\r\nimport {\r\n  CreateDatabaseDto,\r\n  UpdateDatabaseDto,\r\n  DatabaseResponseDto,\r\n  DatabaseListResponseDto,\r\n} from '../../dto/database.dto';\r\nimport { PaginationDto } from '../../../../common/dto/pagination.dto';\r\nimport { JwtAuthGuard } from '../../../auth/guards/jwt-auth.guard';\r\nimport { TierLimitsGuard } from '../../../../common/guards/tier-limits.guard';\r\nimport { DATABASE_ROUTES } from '../../../../common/constants/api-routes.constants';\r\n\r\n@ApiTags('Databases')\r\n@Controller(DATABASE_ROUTES.BASE)\r\n@UseGuards(JwtAuthGuard)\r\n@ApiBearerAuth()\r\nexport class DatabaseController {\r\n  constructor(private readonly databaseService: DatabaseService) {}\r\n\r\n  @Post()\r\n  @UseGuards(TierLimitsGuard)\r\n  @ApiOperation({ summary: 'Create a new database' })\r\n  @ApiResponse({\r\n    status: 201,\r\n    description: 'Database created successfully',\r\n    type: DatabaseResponseDto,\r\n  })\r\n  @ApiResponse({ status: 409, description: 'Database name already exists' })\r\n  @ApiResponse({ status: 403, description: 'Tier limit reached' })\r\n  async create(\r\n    @Body() createDatabaseDto: CreateDatabaseDto,\r\n    @Request() req,\r\n  ): Promise<DatabaseResponseDto> {\r\n    return this.databaseService.create(createDatabaseDto, req.user.userId);\r\n  }\r\n\r\n  @Get()\r\n  @ApiOperation({ summary: 'Get all databases of current user' })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'List of databases',\r\n    type: DatabaseListResponseDto,\r\n  })\r\n  async findAll(\r\n    @Query() paginationDto: PaginationDto,\r\n    @Request() req,\r\n  ): Promise<DatabaseListResponseDto> {\r\n    return this.databaseService.findAllByUser(req.user.userId, paginationDto);\r\n  }\r\n\r\n  @Get(':id')\r\n  @ApiOperation({ summary: 'Get database by ID' })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Database details',\r\n    type: DatabaseResponseDto,\r\n  })\r\n  @ApiResponse({ status: 404, description: 'Database not found' })\r\n  @ApiResponse({ status: 403, description: 'Access denied' })\r\n  async findOne(\r\n    @Param('id') id: string,\r\n    @Request() req,\r\n  ): Promise<DatabaseResponseDto> {\r\n    return this.databaseService.findOne(id, req.user.userId);\r\n  }\r\n\r\n  @Put(':id')\r\n  @ApiOperation({ summary: 'Update database' })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Database updated successfully',\r\n    type: DatabaseResponseDto,\r\n  })\r\n  @ApiResponse({ status: 404, description: 'Database not found' })\r\n  @ApiResponse({ status: 403, description: 'Access denied' })\r\n  async update(\r\n    @Param('id') id: string,\r\n    @Body() updateDatabaseDto: UpdateDatabaseDto,\r\n    @Request() req,\r\n  ): Promise<DatabaseResponseDto> {\r\n    return this.databaseService.update(id, updateDatabaseDto, req.user.userId);\r\n  }\r\n\r\n  @Delete(':id')\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiOperation({ summary: 'Deactivate database (soft delete)' })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Database deactivated successfully',\r\n  })\r\n  @ApiResponse({ status: 404, description: 'Database not found' })\r\n  @ApiResponse({ status: 403, description: 'Access denied' })\r\n  async remove(\r\n    @Param('id') id: string,\r\n    @Request() req,\r\n  ): Promise<{ message: string }> {\r\n    return this.databaseService.remove(id, req.user.userId);\r\n  }\r\n\r\n  @Delete(':id/permanent')\r\n  @HttpCode(HttpStatus.OK)\r\n  @ApiOperation({ summary: 'Permanently delete database' })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Database permanently deleted',\r\n  })\r\n  @ApiResponse({ status: 404, description: 'Database not found' })\r\n  @ApiResponse({ status: 403, description: 'Access denied' })\r\n  async permanentDelete(\r\n    @Param('id') id: string,\r\n    @Request() req,\r\n  ): Promise<{ message: string }> {\r\n    return this.databaseService.permanentDelete(id, req.user.userId);\r\n  }\r\n}\r\n"],"names":["DatabaseController","create","createDatabaseDto","req","databaseService","user","userId","findAll","paginationDto","findAllByUser","findOne","id","update","updateDatabaseDto","remove","permanentDelete","summary","status","description","type","DatabaseResponseDto","DatabaseListResponseDto","OK","BASE"],"mappings":";;;;+BAoCaA;;;eAAAA;;;wBAvBN;yBAMA;iCACyB;6BAMzB;+BACuB;8BACD;iCACG;oCACA;;;;;;;;;;;;;;;AAMzB,IAAA,AAAMA,qBAAN,MAAMA;IAGX,MAUMC,OACJ,AAAQC,iBAAoC,EAC5C,AAAWC,GAAG,EACgB;QAC9B,OAAO,IAAI,CAACC,eAAe,CAACH,MAAM,CAACC,mBAAmBC,IAAIE,IAAI,CAACC,MAAM;IACvE;IAEA,MAOMC,QACJ,AAASC,aAA4B,EACrC,AAAWL,GAAG,EACoB;QAClC,OAAO,IAAI,CAACC,eAAe,CAACK,aAAa,CAACN,IAAIE,IAAI,CAACC,MAAM,EAAEE;IAC7D;IAEA,MASME,QACJ,AAAaC,EAAU,EACvB,AAAWR,GAAG,EACgB;QAC9B,OAAO,IAAI,CAACC,eAAe,CAACM,OAAO,CAACC,IAAIR,IAAIE,IAAI,CAACC,MAAM;IACzD;IAEA,MASMM,OACJ,AAAaD,EAAU,EACvB,AAAQE,iBAAoC,EAC5C,AAAWV,GAAG,EACgB;QAC9B,OAAO,IAAI,CAACC,eAAe,CAACQ,MAAM,CAACD,IAAIE,mBAAmBV,IAAIE,IAAI,CAACC,MAAM;IAC3E;IAEA,MASMQ,OACJ,AAAaH,EAAU,EACvB,AAAWR,GAAG,EACgB;QAC9B,OAAO,IAAI,CAACC,eAAe,CAACU,MAAM,CAACH,IAAIR,IAAIE,IAAI,CAACC,MAAM;IACxD;IAEA,MASMS,gBACJ,AAAaJ,EAAU,EACvB,AAAWR,GAAG,EACgB;QAC9B,OAAO,IAAI,CAACC,eAAe,CAACW,eAAe,CAACJ,IAAIR,IAAIE,IAAI,CAACC,MAAM;IACjE;IAhGA,YAAY,AAAiBF,eAAgC,CAAE;aAAlCA,kBAAAA;IAAmC;AAiGlE;;;;;QA7FkBY,SAAS;;;QAEvBC,QAAQ;QACRC,aAAa;QACbC,MAAMC,gCAAmB;;;QAEZH,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QASzBF,SAAS;;;QAEvBC,QAAQ;QACRC,aAAa;QACbC,MAAME,oCAAuB;;;;;;;;;;;;;;QAUfL,SAAS;;;QAEvBC,QAAQ;QACRC,aAAa;QACbC,MAAMC,gCAAmB;;;QAEZH,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QASzBF,SAAS;;;QAEvBC,QAAQ;QACRC,aAAa;QACbC,MAAMC,gCAAmB;;;QAEZH,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;6CAUpBI;;QACLN,SAAS;;;QAEvBC,QAAQ;QACRC,aAAa;;;QAEAD,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;6CASpBI;;QACLN,SAAS;;;QAEvBC,QAAQ;QACRC,aAAa;;;QAEAD,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;gEA9FfK"}