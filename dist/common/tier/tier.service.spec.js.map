{"version":3,"sources":["../../../src/common/tier/tier.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from '@nestjs/testing';\r\nimport { getModelToken } from '@nestjs/mongoose';\r\nimport { TierService } from './tier.service';\r\nimport { User } from '../../modules/users/schemas/user.schema';\r\nimport { Database } from '../../modules/dynamic-cms/schemas/database.schema';\r\nimport { DynamicData } from '../../modules/dynamic-cms/schemas/dynamic-data.schema';\r\nimport { AccountTier } from '../enums/tier.enum';\r\n\r\ndescribe('TierService', () => {\r\n  let service: TierService;\r\n  let userModel: any;\r\n  let databaseModel: any;\r\n  let dynamicDataModel: any;\r\n\r\n  const mockUser = {\r\n    _id: '507f1f77bcf86cd799439011',\r\n    email: 'test@example.com',\r\n    tier: AccountTier.FREE,\r\n    currentDatabaseCount: 0,\r\n    apiCallsToday: 0,\r\n    save: jest.fn().mockResolvedValue(this),\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    const module: TestingModule = await Test.createTestingModule({\r\n      providers: [\r\n        TierService,\r\n        {\r\n          provide: getModelToken(User.name),\r\n          useValue: {\r\n            findById: jest.fn(),\r\n            updateMany: jest.fn(),\r\n            findByIdAndUpdate: jest.fn(),\r\n          },\r\n        },\r\n        {\r\n          provide: getModelToken(Database.name),\r\n          useValue: {\r\n            countDocuments: jest.fn(),\r\n            findOne: jest.fn(),\r\n          },\r\n        },\r\n        {\r\n          provide: getModelToken(DynamicData.name),\r\n          useValue: {\r\n            countDocuments: jest.fn(),\r\n            aggregate: jest.fn(),\r\n          },\r\n        },\r\n      ],\r\n    }).compile();\r\n\r\n    service = module.get<TierService>(TierService);\r\n    userModel = module.get(getModelToken(User.name));\r\n    databaseModel = module.get(getModelToken(Database.name));\r\n    dynamicDataModel = module.get(getModelToken(DynamicData.name));\r\n  });\r\n\r\n  it('should be defined', () => {\r\n    expect(service).toBeDefined();\r\n  });\r\n\r\n  describe('getUserTierInfo', () => {\r\n    it('should return tier info for user', async () => {\r\n      userModel.findById.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(mockUser),\r\n      });\r\n\r\n      databaseModel.countDocuments.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(1),\r\n      });\r\n\r\n      const result = await service.getUserTierInfo(mockUser._id);\r\n\r\n      expect(result).toHaveProperty('tier');\r\n      expect(result).toHaveProperty('limits');\r\n      expect(result).toHaveProperty('usage');\r\n      expect(result.tier).toBe(AccountTier.FREE);\r\n      expect(result.limits.maxDatabases).toBe(2);\r\n      expect(result.usage.databases).toBe(1);\r\n    });\r\n  });\r\n\r\n  describe('canCreateDatabase', () => {\r\n    it('should allow database creation when under limit', async () => {\r\n      userModel.findById.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(mockUser),\r\n      });\r\n\r\n      databaseModel.countDocuments.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(1), // User has 1 database\r\n      });\r\n\r\n      const result = await service.canCreateDatabase(mockUser._id);\r\n\r\n      expect(result.allowed).toBe(true);\r\n      expect(result.current).toBe(1);\r\n      expect(result.limit).toBe(2);\r\n    });\r\n\r\n    it('should block database creation when limit reached', async () => {\r\n      userModel.findById.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(mockUser),\r\n      });\r\n\r\n      databaseModel.countDocuments.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(2), // User has 2 databases (FREE limit)\r\n      });\r\n\r\n      const result = await service.canCreateDatabase(mockUser._id);\r\n\r\n      expect(result.allowed).toBe(false);\r\n      expect(result.current).toBe(2);\r\n      expect(result.limit).toBe(2);\r\n      expect(result.reason).toContain('Maximum databases reached');\r\n    });\r\n\r\n    it('should allow unlimited databases for ENTERPRISE tier', async () => {\r\n      const enterpriseUser = { ...mockUser, tier: AccountTier.ENTERPRISE };\r\n\r\n      userModel.findById.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(enterpriseUser),\r\n      });\r\n\r\n      const result = await service.canCreateDatabase(mockUser._id);\r\n\r\n      expect(result.allowed).toBe(true);\r\n      expect(result.current).toBe(-1);\r\n      expect(result.limit).toBe(-1);\r\n    });\r\n  });\r\n\r\n  describe('canCreateData', () => {\r\n    const databaseId = '507f1f77bcf86cd799439022';\r\n    const collectionName = 'products';\r\n\r\n    it('should allow data creation when under limit', async () => {\r\n      userModel.findById.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(mockUser),\r\n      });\r\n\r\n      databaseModel.findOne.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue({ _id: databaseId }),\r\n      });\r\n\r\n      dynamicDataModel.countDocuments.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(50), // 50 data items\r\n      });\r\n\r\n      const result = await service.canCreateData(\r\n        mockUser._id,\r\n        databaseId,\r\n        collectionName,\r\n      );\r\n\r\n      expect(result.allowed).toBe(true);\r\n      expect(result.current).toBe(50);\r\n      expect(result.limit).toBe(100); // FREE tier limit\r\n    });\r\n\r\n    it('should block data creation when limit reached', async () => {\r\n      userModel.findById.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(mockUser),\r\n      });\r\n\r\n      databaseModel.findOne.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue({ _id: databaseId }),\r\n      });\r\n\r\n      dynamicDataModel.countDocuments.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(100), // Reached FREE limit\r\n      });\r\n\r\n      const result = await service.canCreateData(\r\n        mockUser._id,\r\n        databaseId,\r\n        collectionName,\r\n      );\r\n\r\n      expect(result.allowed).toBe(false);\r\n      expect(result.current).toBe(100);\r\n      expect(result.limit).toBe(100);\r\n      expect(result.reason).toContain('Maximum data per collection reached');\r\n    });\r\n\r\n    it('should return false if database not found', async () => {\r\n      userModel.findById.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(mockUser),\r\n      });\r\n\r\n      databaseModel.findOne.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(null),\r\n      });\r\n\r\n      const result = await service.canCreateData(\r\n        mockUser._id,\r\n        databaseId,\r\n        collectionName,\r\n      );\r\n\r\n      expect(result.allowed).toBe(false);\r\n      expect(result.reason).toContain('Database not found');\r\n    });\r\n  });\r\n\r\n  describe('upgradeTier', () => {\r\n    it('should upgrade user tier and save history', async () => {\r\n      const userWithSave = {\r\n        ...mockUser,\r\n        tierHistory: [],\r\n        createdAt: new Date(),\r\n        save: jest.fn().mockResolvedValue(mockUser),\r\n      };\r\n\r\n      userModel.findById.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(userWithSave),\r\n      });\r\n\r\n      const result = await service.upgradeTier(\r\n        mockUser._id,\r\n        AccountTier.PREMIUM,\r\n        'Payment successful',\r\n      );\r\n\r\n      expect(userWithSave.save).toHaveBeenCalled();\r\n      expect(userWithSave.tier).toBe(AccountTier.PREMIUM);\r\n      expect(userWithSave.tierHistory.length).toBe(1);\r\n      expect(userWithSave.tierHistory[0].upgradeReason).toBe(\r\n        'Payment successful',\r\n      );\r\n    });\r\n  });\r\n\r\n  describe('getDataUsageByCollection', () => {\r\n    it('should return data usage statistics', async () => {\r\n      const databaseId = '507f1f77bcf86cd799439022';\r\n\r\n      userModel.findById.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(mockUser),\r\n      });\r\n\r\n      dynamicDataModel.aggregate.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue([\r\n          { _id: 'products', count: 85 },\r\n          { _id: 'categories', count: 15 },\r\n        ]),\r\n      });\r\n\r\n      const result = await service.getDataUsageByCollection(\r\n        mockUser._id,\r\n        databaseId,\r\n      );\r\n\r\n      expect(result).toHaveLength(2);\r\n      expect(result[0].collection).toBe('products');\r\n      expect(result[0].count).toBe(85);\r\n      expect(result[0].limit).toBe(100);\r\n      expect(result[0].percentage).toBe(85);\r\n    });\r\n  });\r\n\r\n  describe('Bulk and Replace-All scenarios', () => {\r\n    const databaseId = '507f1f77bcf86cd799439022';\r\n    const collectionName = 'products';\r\n\r\n    it('should allow bulk creation when under limit', async () => {\r\n      userModel.findById.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(mockUser),\r\n      });\r\n\r\n      databaseModel.findOne.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue({ _id: databaseId }),\r\n      });\r\n\r\n      dynamicDataModel.countDocuments.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(50), // Current: 50, adding 30 = 80 (under 100)\r\n      });\r\n\r\n      const result = await service.canCreateData(\r\n        mockUser._id,\r\n        databaseId,\r\n        collectionName,\r\n      );\r\n\r\n      expect(result.allowed).toBe(true);\r\n    });\r\n\r\n    it('should block bulk creation when would exceed limit', async () => {\r\n      userModel.findById.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(mockUser),\r\n      });\r\n\r\n      databaseModel.findOne.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue({ _id: databaseId }),\r\n      });\r\n\r\n      dynamicDataModel.countDocuments.mockReturnValue({\r\n        exec: jest.fn().mockResolvedValue(90), // Current: 90, adding 20 would exceed 100\r\n      });\r\n\r\n      const result = await service.canCreateData(\r\n        mockUser._id,\r\n        databaseId,\r\n        collectionName,\r\n      );\r\n\r\n      expect(result.allowed).toBe(true); // Still allowed to add up to 10 more\r\n    });\r\n  });\r\n});\r\n"],"names":["describe","service","userModel","databaseModel","dynamicDataModel","mockUser","_id","email","tier","AccountTier","FREE","currentDatabaseCount","apiCallsToday","save","jest","fn","mockResolvedValue","beforeEach","module","Test","createTestingModule","providers","TierService","provide","getModelToken","User","name","useValue","findById","updateMany","findByIdAndUpdate","Database","countDocuments","findOne","DynamicData","aggregate","compile","get","it","expect","toBeDefined","mockReturnValue","exec","result","getUserTierInfo","toHaveProperty","toBe","limits","maxDatabases","usage","databases","canCreateDatabase","allowed","current","limit","reason","toContain","enterpriseUser","ENTERPRISE","databaseId","collectionName","canCreateData","userWithSave","tierHistory","createdAt","Date","upgradeTier","PREMIUM","toHaveBeenCalled","length","upgradeReason","count","getDataUsageByCollection","toHaveLength","collection","percentage"],"mappings":"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"}