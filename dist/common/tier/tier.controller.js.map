{"version":3,"sources":["../../../src/common/tier/tier.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Body,\r\n  Request,\r\n  UseGuards,\r\n  Param,\r\n} from '@nestjs/common';\r\nimport {\r\n  ApiTags,\r\n  ApiOperation,\r\n  ApiResponse,\r\n  ApiBearerAuth,\r\n} from '@nestjs/swagger';\r\nimport { TierService } from './tier.service';\r\nimport { JwtAuthGuard } from '../../modules/auth/guards/jwt-auth.guard';\r\nimport {\r\n  UpgradeTierDto,\r\n  TierInfoResponseDto,\r\n  LimitCheckResponseDto,\r\n  DataUsageResponseDto,\r\n} from '../dto/tier.dto';\r\nimport { TIER_ROUTES } from '../constants/api-routes.constants';\r\n\r\n@ApiTags('Tier Management')\r\n@Controller(TIER_ROUTES.BASE)\r\n@UseGuards(JwtAuthGuard)\r\n@ApiBearerAuth()\r\nexport class TierController {\r\n  constructor(private readonly tierService: TierService) {}\r\n\r\n  @Get('info')\r\n  @ApiOperation({ summary: 'Get current user tier information and limits' })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Tier information retrieved successfully',\r\n    type: TierInfoResponseDto,\r\n  })\r\n  async getTierInfo(@Request() req): Promise<TierInfoResponseDto> {\r\n    return this.tierService.getUserTierInfo(req.user.userId);\r\n  }\r\n\r\n  @Get('check-database-limit')\r\n  @ApiOperation({ summary: 'Check if user can create more databases' })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Database limit check result',\r\n    type: LimitCheckResponseDto,\r\n  })\r\n  async checkDatabaseLimit(@Request() req): Promise<LimitCheckResponseDto> {\r\n    return this.tierService.canCreateDatabase(req.user.userId);\r\n  }\r\n\r\n  @Get('check-data-limit/:databaseId/:collectionName')\r\n  @ApiOperation({\r\n    summary: 'Check if user can create more data in a collection',\r\n  })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Data limit check result',\r\n    type: LimitCheckResponseDto,\r\n  })\r\n  async checkDataLimit(\r\n    @Param('databaseId') databaseId: string,\r\n    @Param('collectionName') collectionName: string,\r\n    @Request() req,\r\n  ): Promise<LimitCheckResponseDto> {\r\n    return this.tierService.canCreateData(\r\n      req.user.userId,\r\n      databaseId,\r\n      collectionName,\r\n    );\r\n  }\r\n\r\n  @Get('usage')\r\n  @ApiOperation({ summary: 'Get data usage statistics for all databases' })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'All databases usage statistics retrieved successfully',\r\n  })\r\n  async getAllDataUsage(@Request() req) {\r\n    return this.tierService.getAllDataUsage(req.user.userId);\r\n  }\r\n\r\n  @Get('usage/:databaseId')\r\n  @ApiOperation({\r\n    summary: 'Get data usage statistics by collection for a specific database',\r\n  })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Data usage statistics retrieved successfully',\r\n    type: [DataUsageResponseDto],\r\n  })\r\n  async getDataUsage(\r\n    @Param('databaseId') databaseId: string,\r\n    @Request() req,\r\n  ): Promise<DataUsageResponseDto[]> {\r\n    return this.tierService.getDataUsageByCollection(\r\n      req.user.userId,\r\n      databaseId,\r\n    );\r\n  }\r\n\r\n  @Post('upgrade')\r\n  @ApiOperation({ summary: 'Upgrade user tier (admin only for now)' })\r\n  @ApiResponse({\r\n    status: 200,\r\n    description: 'Tier upgraded successfully',\r\n  })\r\n  async upgradeTier(@Body() upgradeTierDto: UpgradeTierDto) {\r\n    return this.tierService.upgradeTier(\r\n      upgradeTierDto.userId,\r\n      upgradeTierDto.newTier,\r\n      upgradeTierDto.reason,\r\n    );\r\n  }\r\n}\r\n"],"names":["TierController","getTierInfo","req","tierService","getUserTierInfo","user","userId","checkDatabaseLimit","canCreateDatabase","checkDataLimit","databaseId","collectionName","canCreateData","getAllDataUsage","getDataUsage","getDataUsageByCollection","upgradeTier","upgradeTierDto","newTier","reason","summary","status","description","type","TierInfoResponseDto","LimitCheckResponseDto","DataUsageResponseDto","BASE"],"mappings":";;;;+BA6BaA;;;eAAAA;;;wBArBN;yBAMA;6BACqB;8BACC;yBAMtB;oCACqB;;;;;;;;;;;;;;;AAMrB,IAAA,AAAMA,iBAAN,MAAMA;IAGX,MAOMC,YAAY,AAAWC,GAAG,EAAgC;QAC9D,OAAO,IAAI,CAACC,WAAW,CAACC,eAAe,CAACF,IAAIG,IAAI,CAACC,MAAM;IACzD;IAEA,MAOMC,mBAAmB,AAAWL,GAAG,EAAkC;QACvE,OAAO,IAAI,CAACC,WAAW,CAACK,iBAAiB,CAACN,IAAIG,IAAI,CAACC,MAAM;IAC3D;IAEA,MASMG,eACJ,AAAqBC,UAAkB,EACvC,AAAyBC,cAAsB,EAC/C,AAAWT,GAAG,EACkB;QAChC,OAAO,IAAI,CAACC,WAAW,CAACS,aAAa,CACnCV,IAAIG,IAAI,CAACC,MAAM,EACfI,YACAC;IAEJ;IAEA,MAMME,gBAAgB,AAAWX,GAAG,EAAE;QACpC,OAAO,IAAI,CAACC,WAAW,CAACU,eAAe,CAACX,IAAIG,IAAI,CAACC,MAAM;IACzD;IAEA,MASMQ,aACJ,AAAqBJ,UAAkB,EACvC,AAAWR,GAAG,EACmB;QACjC,OAAO,IAAI,CAACC,WAAW,CAACY,wBAAwB,CAC9Cb,IAAIG,IAAI,CAACC,MAAM,EACfI;IAEJ;IAEA,MAMMM,YAAY,AAAQC,cAA8B,EAAE;QACxD,OAAO,IAAI,CAACd,WAAW,CAACa,WAAW,CACjCC,eAAeX,MAAM,EACrBW,eAAeC,OAAO,EACtBD,eAAeE,MAAM;IAEzB;IAtFA,YAAY,AAAiBhB,WAAwB,CAAE;aAA1BA,cAAAA;IAA2B;AAuF1D;;;;QApFkBiB,SAAS;;;QAEvBC,QAAQ;QACRC,aAAa;QACbC,MAAMC,4BAAmB;;;;;;;;;;;;QAOXJ,SAAS;;;QAEvBC,QAAQ;QACRC,aAAa;QACbC,MAAME,8BAAqB;;;;;;;;;;;;QAQ3BL,SAAS;;;QAGTC,QAAQ;QACRC,aAAa;QACbC,MAAME,8BAAqB;;;;;;;;;;;;;;;;QAebL,SAAS;;;QAEvBC,QAAQ;QACRC,aAAa;;;;;;;;;;;;QAQbF,SAAS;;;QAGTC,QAAQ;QACRC,aAAa;QACbC,MAAM;YAACG,6BAAoB;SAAC;;;;;;;;;;;;;;QAadN,SAAS;;;QAEvBC,QAAQ;QACRC,aAAa;;;;;;;;;;;4DAlFOK"}