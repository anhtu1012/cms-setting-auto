{"version":3,"sources":["../../../src/common/tier/tier-config.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Put,\r\n  Delete,\r\n  Body,\r\n  Param,\r\n  Query,\r\n  UseGuards,\r\n} from '@nestjs/common';\r\nimport {\r\n  ApiTags,\r\n  ApiOperation,\r\n  ApiResponse,\r\n  ApiBearerAuth,\r\n} from '@nestjs/swagger';\r\nimport { TierConfigService } from './tier-config.service';\r\nimport {\r\n  CreateTierConfigDto,\r\n  UpdateTierConfigDto,\r\n} from './dto/tier-config.dto';\r\nimport { JwtAuthGuard } from '../../modules/auth/guards/jwt-auth.guard';\r\n\r\n@ApiTags('Tier Configuration')\r\n@Controller('v1/tier-config')\r\nexport class TierConfigController {\r\n  constructor(private readonly tierConfigService: TierConfigService) {}\r\n\r\n  /**\r\n   * Lấy tất cả tier configs\r\n   * Public API - không cần authentication\r\n   */\r\n  @Get()\r\n  @ApiOperation({ summary: 'Lấy danh sách tất cả tiers' })\r\n  @ApiResponse({ status: 200, description: 'Thành công' })\r\n  async getAllTiers(@Query('includeInactive') includeInactive?: boolean) {\r\n    return this.tierConfigService.getAllTiers(includeInactive === true);\r\n  }\r\n\r\n  /**\r\n   * Lấy tier theo code\r\n   */\r\n  @Get(':tierCode')\r\n  @ApiOperation({ summary: 'Lấy thông tin tier theo code' })\r\n  @ApiResponse({ status: 200, description: 'Thành công' })\r\n  @ApiResponse({ status: 404, description: 'Không tìm thấy tier' })\r\n  async getTierByCode(@Param('tierCode') tierCode: string) {\r\n    return this.tierConfigService.getTierByCode(tierCode);\r\n  }\r\n\r\n  /**\r\n   * Lấy tier limits (chỉ limits, không bao gồm giá...)\r\n   */\r\n  @Get(':tierCode/limits')\r\n  @ApiOperation({ summary: 'Lấy thông tin giới hạn của tier' })\r\n  @ApiResponse({ status: 200, description: 'Thành công' })\r\n  @ApiResponse({ status: 404, description: 'Không tìm thấy tier' })\r\n  async getTierLimits(@Param('tierCode') tierCode: string) {\r\n    return this.tierConfigService.getTierLimits(tierCode);\r\n  }\r\n\r\n  /**\r\n   * Tạo tier mới\r\n   * Chỉ admin mới có quyền tạo\r\n   */\r\n  @Post()\r\n  @UseGuards(JwtAuthGuard) // Có thể thêm AdminGuard nếu cần\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Tạo tier mới (Admin only)' })\r\n  @ApiResponse({ status: 201, description: 'Tạo thành công' })\r\n  @ApiResponse({ status: 409, description: 'Tier code đã tồn tại' })\r\n  async createTier(@Body() createDto: CreateTierConfigDto) {\r\n    return this.tierConfigService.createTier(createDto);\r\n  }\r\n\r\n  /**\r\n   * Cập nhật tier\r\n   * Chỉ admin mới có quyền update\r\n   */\r\n  @Put(':tierCode')\r\n  @UseGuards(JwtAuthGuard) // Có thể thêm AdminGuard nếu cần\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Cập nhật tier (Admin only)' })\r\n  @ApiResponse({ status: 200, description: 'Cập nhật thành công' })\r\n  @ApiResponse({ status: 404, description: 'Không tìm thấy tier' })\r\n  async updateTier(\r\n    @Param('tierCode') tierCode: string,\r\n    @Body() updateDto: UpdateTierConfigDto,\r\n  ) {\r\n    return this.tierConfigService.updateTier(tierCode, updateDto);\r\n  }\r\n\r\n  /**\r\n   * Xóa tier (soft delete)\r\n   * Chỉ admin mới có quyền xóa\r\n   */\r\n  @Delete(':tierCode')\r\n  @UseGuards(JwtAuthGuard) // Có thể thêm AdminGuard nếu cần\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Xóa tier - soft delete (Admin only)' })\r\n  @ApiResponse({ status: 200, description: 'Xóa thành công' })\r\n  @ApiResponse({ status: 404, description: 'Không tìm thấy tier' })\r\n  async deleteTier(@Param('tierCode') tierCode: string) {\r\n    await this.tierConfigService.deleteTier(tierCode);\r\n    return { message: `Tier '${tierCode}' has been deleted` };\r\n  }\r\n\r\n  /**\r\n   * Hard delete tier (Cẩn thận!)\r\n   * Chỉ admin mới có quyền\r\n   */\r\n  @Delete(':tierCode/hard')\r\n  @UseGuards(JwtAuthGuard) // Có thể thêm AdminGuard nếu cần\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Xóa vĩnh viễn tier (Admin only - Cẩn thận!)' })\r\n  @ApiResponse({ status: 200, description: 'Xóa thành công' })\r\n  @ApiResponse({ status: 404, description: 'Không tìm thấy tier' })\r\n  async hardDeleteTier(@Param('tierCode') tierCode: string) {\r\n    await this.tierConfigService.hardDeleteTier(tierCode);\r\n    return { message: `Tier '${tierCode}' has been permanently deleted` };\r\n  }\r\n\r\n  /**\r\n   * Seed default tiers\r\n   * Chỉ dùng lần đầu setup hoặc reset\r\n   */\r\n  @Post('seed/defaults')\r\n  @UseGuards(JwtAuthGuard) // Có thể thêm AdminGuard nếu cần\r\n  @ApiBearerAuth()\r\n  @ApiOperation({ summary: 'Seed default tiers vào database (Admin only)' })\r\n  @ApiResponse({ status: 201, description: 'Seed thành công' })\r\n  async seedDefaultTiers() {\r\n    await this.tierConfigService.seedDefaultTiers();\r\n    return { message: 'Default tiers have been seeded successfully' };\r\n  }\r\n}\r\n"],"names":["TierConfigController","getAllTiers","includeInactive","tierConfigService","getTierByCode","tierCode","getTierLimits","createTier","createDto","updateTier","updateDto","deleteTier","message","hardDeleteTier","seedDefaultTiers","summary","status","description"],"mappings":";;;;+BA0BaA;;;eAAAA;;;wBAhBN;yBAMA;mCAC2B;+BAI3B;8BACsB;;;;;;;;;;;;;;;AAItB,IAAA,AAAMA,uBAAN,MAAMA;IAGX;;;GAGC,GACD,MAGMC,YAAY,AAA0BC,eAAyB,EAAE;QACrE,OAAO,IAAI,CAACC,iBAAiB,CAACF,WAAW,CAACC,oBAAoB;IAChE;IAEA;;GAEC,GACD,MAIME,cAAc,AAAmBC,QAAgB,EAAE;QACvD,OAAO,IAAI,CAACF,iBAAiB,CAACC,aAAa,CAACC;IAC9C;IAEA;;GAEC,GACD,MAIMC,cAAc,AAAmBD,QAAgB,EAAE;QACvD,OAAO,IAAI,CAACF,iBAAiB,CAACG,aAAa,CAACD;IAC9C;IAEA;;;GAGC,GACD,MAMME,WAAW,AAAQC,SAA8B,EAAE;QACvD,OAAO,IAAI,CAACL,iBAAiB,CAACI,UAAU,CAACC;IAC3C;IAEA;;;GAGC,GACD,MAMMC,WACJ,AAAmBJ,QAAgB,EACnC,AAAQK,SAA8B,EACtC;QACA,OAAO,IAAI,CAACP,iBAAiB,CAACM,UAAU,CAACJ,UAAUK;IACrD;IAEA;;;GAGC,GACD,MAMMC,WAAW,AAAmBN,QAAgB,EAAE;QACpD,MAAM,IAAI,CAACF,iBAAiB,CAACQ,UAAU,CAACN;QACxC,OAAO;YAAEO,SAAS,CAAC,MAAM,EAAEP,SAAS,kBAAkB,CAAC;QAAC;IAC1D;IAEA;;;GAGC,GACD,MAMMQ,eAAe,AAAmBR,QAAgB,EAAE;QACxD,MAAM,IAAI,CAACF,iBAAiB,CAACU,cAAc,CAACR;QAC5C,OAAO;YAAEO,SAAS,CAAC,MAAM,EAAEP,SAAS,8BAA8B,CAAC;QAAC;IACtE;IAEA;;;GAGC,GACD,MAKMS,mBAAmB;QACvB,MAAM,IAAI,CAACX,iBAAiB,CAACW,gBAAgB;QAC7C,OAAO;YAAEF,SAAS;QAA8C;IAClE;IA5GA,YAAY,AAAiBT,iBAAoC,CAAE;aAAtCA,oBAAAA;IAAuC;AA6GtE;;;;QAtGkBY,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QASzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;QASzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAYzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAYzBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;;;QAezBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAazBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa;;;QAC1BD,QAAQ;QAAKC,aAAa;;;;;;;;;;;;;;QAazBF,SAAS;;;QACVC,QAAQ;QAAKC,aAAa"}