{"version":3,"sources":["../src/main.ts"],"sourcesContent":["import { NestFactory } from '@nestjs/core';\r\nimport { ValidationPipe } from '@nestjs/common';\r\nimport { DocumentBuilder, SwaggerModule } from '@nestjs/swagger';\r\nimport { AppModule } from './app.module';\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create(AppModule);\r\n\r\n  // Enable validation globally\r\n  app.useGlobalPipes(\r\n    new ValidationPipe({\r\n      whitelist: true,\r\n      // Do not throw on unknown properties; strip them instead.\r\n      // This prevents 400 errors like \"property X should not exist\" when clients\r\n      // send extra metadata (e.g., databaseId in some payloads).\r\n      forbidNonWhitelisted: false,\r\n      transform: true,\r\n    }),\r\n  );\r\n\r\n  // Enable CORS\r\n  // Configure CORS from environment variable CORS_ORIGINS (comma-separated list)\r\n  const rawOrigins = process.env.CORS_ORIGINS || '';\r\n  const allowedOrigins = rawOrigins\r\n    .split(',')\r\n    .map((s) => s.trim())\r\n    .filter(Boolean);\r\n\r\n  if (allowedOrigins.length === 0) {\r\n    // If no origins specified, disable strict origin checks (development friendly)\r\n    app.enableCors({ origin: true, credentials: true });\r\n    console.log('CORS: allowing any origin (no CORS_ORIGINS set)');\r\n  } else {\r\n    app.enableCors({\r\n      origin: (origin, callback) => {\r\n        // Allow requests with no origin (e.g., mobile apps, curl, Swagger UI)\r\n        if (!origin) return callback(null, true);\r\n\r\n        // Check if origin is in whitelist\r\n        if (allowedOrigins.indexOf(origin) !== -1) {\r\n          return callback(null, true);\r\n        }\r\n\r\n        // Log rejected origin for debugging\r\n        console.log(\r\n          `⚠️  CORS: Rejected origin \"${origin}\". Allowed origins: ${allowedOrigins.join(', ')}`,\r\n        );\r\n        return callback(new Error('CORS policy: Origin not allowed'), false);\r\n      },\r\n      credentials: true,\r\n    });\r\n    console.log(`✅ CORS: allowed origins: ${allowedOrigins.join(', ')}`);\r\n  }\r\n\r\n  // Swagger configuration\r\n  const config = new DocumentBuilder()\r\n    .setTitle('CMS Setting Auto API')\r\n    .setDescription('CMS system with MongoDB - API Documentation')\r\n    .setVersion('1.0')\r\n    .addTag('users', 'User management endpoints')\r\n    .addTag('settings', 'Settings management endpoints')\r\n    .addTag('content', 'Content management endpoints')\r\n    .addBearerAuth()\r\n    .build();\r\n\r\n  const document = SwaggerModule.createDocument(app, config);\r\n  SwaggerModule.setup('api', app, document);\r\n\r\n  await app.listen(process.env.PORT ?? 3000);\r\n  console.log(\r\n    `Application is running on: http://localhost:${process.env.PORT ?? 3000}`,\r\n  );\r\n  console.log(\r\n    `Swagger documentation is available at: http://localhost:${process.env.PORT ?? 3000}/api`,\r\n  );\r\n}\r\nbootstrap();\r\n"],"names":["bootstrap","app","NestFactory","create","AppModule","useGlobalPipes","ValidationPipe","whitelist","forbidNonWhitelisted","transform","rawOrigins","process","env","CORS_ORIGINS","allowedOrigins","split","map","s","trim","filter","Boolean","length","enableCors","origin","credentials","console","log","callback","indexOf","join","Error","config","DocumentBuilder","setTitle","setDescription","setVersion","addTag","addBearerAuth","build","document","SwaggerModule","createDocument","setup","listen","PORT"],"mappings":";;;;sBAA4B;wBACG;yBACgB;2BACrB;AAE1B,eAAeA;IACb,MAAMC,MAAM,MAAMC,iBAAW,CAACC,MAAM,CAACC,oBAAS;IAE9C,6BAA6B;IAC7BH,IAAII,cAAc,CAChB,IAAIC,sBAAc,CAAC;QACjBC,WAAW;QACX,0DAA0D;QAC1D,2EAA2E;QAC3E,2DAA2D;QAC3DC,sBAAsB;QACtBC,WAAW;IACb;IAGF,cAAc;IACd,+EAA+E;IAC/E,MAAMC,aAAaC,QAAQC,GAAG,CAACC,YAAY,IAAI;IAC/C,MAAMC,iBAAiBJ,WACpBK,KAAK,CAAC,KACNC,GAAG,CAAC,CAACC,IAAMA,EAAEC,IAAI,IACjBC,MAAM,CAACC;IAEV,IAAIN,eAAeO,MAAM,KAAK,GAAG;QAC/B,+EAA+E;QAC/EpB,IAAIqB,UAAU,CAAC;YAAEC,QAAQ;YAAMC,aAAa;QAAK;QACjDC,QAAQC,GAAG,CAAC;IACd,OAAO;QACLzB,IAAIqB,UAAU,CAAC;YACbC,QAAQ,CAACA,QAAQI;gBACf,sEAAsE;gBACtE,IAAI,CAACJ,QAAQ,OAAOI,SAAS,MAAM;gBAEnC,kCAAkC;gBAClC,IAAIb,eAAec,OAAO,CAACL,YAAY,CAAC,GAAG;oBACzC,OAAOI,SAAS,MAAM;gBACxB;gBAEA,oCAAoC;gBACpCF,QAAQC,GAAG,CACT,CAAC,2BAA2B,EAAEH,OAAO,oBAAoB,EAAET,eAAee,IAAI,CAAC,OAAO;gBAExF,OAAOF,SAAS,IAAIG,MAAM,oCAAoC;YAChE;YACAN,aAAa;QACf;QACAC,QAAQC,GAAG,CAAC,CAAC,yBAAyB,EAAEZ,eAAee,IAAI,CAAC,OAAO;IACrE;IAEA,wBAAwB;IACxB,MAAME,SAAS,IAAIC,wBAAe,GAC/BC,QAAQ,CAAC,wBACTC,cAAc,CAAC,+CACfC,UAAU,CAAC,OACXC,MAAM,CAAC,SAAS,6BAChBA,MAAM,CAAC,YAAY,iCACnBA,MAAM,CAAC,WAAW,gCAClBC,aAAa,GACbC,KAAK;IAER,MAAMC,WAAWC,sBAAa,CAACC,cAAc,CAACxC,KAAK8B;IACnDS,sBAAa,CAACE,KAAK,CAAC,OAAOzC,KAAKsC;IAEhC,MAAMtC,IAAI0C,MAAM,CAAChC,QAAQC,GAAG,CAACgC,IAAI,IAAI;IACrCnB,QAAQC,GAAG,CACT,CAAC,4CAA4C,EAAEf,QAAQC,GAAG,CAACgC,IAAI,IAAI,MAAM;IAE3EnB,QAAQC,GAAG,CACT,CAAC,wDAAwD,EAAEf,QAAQC,GAAG,CAACgC,IAAI,IAAI,KAAK,IAAI,CAAC;AAE7F;AACA5C"}